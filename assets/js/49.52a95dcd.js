(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{412:function(s,a,t){"use strict";t.r(a);var e=t(42),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"pm2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[s._v("#")]),s._v(" pm2")]),s._v(" "),t("p",[s._v("pm2（process manager）是一个进程管理工具，维护一个进程列表，可以用它来管理你的node进程，负责所有正在运行的进程，并查看node进程的状态，也支持性能监控，负载均衡等功能。")]),s._v(" "),t("p",[s._v("使用pm2部署nodejs服务，pm2 启动nodejs应用为守护进程，并且开机自启动")]),s._v(" "),t("blockquote",[t("ol",[t("li",[s._v("日志管理；两种日志，pm2系统日志与管理的进程日志，默认会把进程的控制台输出记录到日志中；")]),s._v(" "),t("li",[s._v("负载均衡：PM2可以通过创建共享同一服务器端口的多个子进程来扩展您的应用程序。这样做还允许以零秒停机时间重新启动应用程序。")]),s._v(" "),t("li",[s._v("终端监控：可以在终端中监控应用程序并检查应用程序运行状况（CPU使用率，使用的内存，请求/分钟等）。")]),s._v(" "),t("li",[s._v("SSH部署：自动部署，避免逐个在所有服务器中进行ssh。")]),s._v(" "),t("li",[s._v("静态服务：支持静态服务器功能")]),s._v(" "),t("li",[s._v("支持开发调试模式，非后台运行，pm2-dev start "),t("appName",[s._v("；")])],1)])]),s._v(" "),t("p",[s._v("使用pm2管理的node程序的好处：")]),s._v(" "),t("blockquote",[t("ol",[t("li",[s._v("监听文件变化，自动重启程序")]),s._v(" "),t("li",[s._v("支持性能监控")]),s._v(" "),t("li",[s._v("负载均衡")]),s._v(" "),t("li",[s._v("程序崩溃自动重启")]),s._v(" "),t("li",[s._v("服务器重新启动时自动重新启动")]),s._v(" "),t("li",[s._v("自动化部署项目")])])]),s._v(" "),t("h2",{attrs:{id:"命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),t("h3",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pm2 start\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("pm2 start app.js 启动app项目")]),s._v(" "),t("p",[s._v("pm2 start app.js --name app //启动应用并设置name")]),s._v(" "),t("p",[s._v('pm2 start app.js --name="api" # 启动应用程序并命名为 "api"')]),s._v(" "),t("p",[s._v("pm2 start app.sh    //脚本启动")]),s._v(" "),t("p",[s._v("pm2 start app.js --watch //监听模式启动，当文件发生变化，自动重启")]),s._v(" "),t("p",[s._v("//max 表示PM2将自动检测可用CPU的数量并运行尽可能多的进程")]),s._v(" "),t("p",[s._v("//max可以自定义，如果是4核CPU，设置为2则占用2个")]),s._v(" "),t("p",[s._v("pm2 start app.js -i max //启用群集模式（自动负载均衡）")]),s._v(" "),t("p",[s._v("pm2 start app.js -i 4     # cluster mode 模式启动4个app.js的应用")])]),s._v(" "),t("h3",{attrs:{id:"查看启动列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看启动列表"}},[s._v("#")]),s._v(" 查看启动列表")]),s._v(" "),t("p",[s._v("列出由pm2管理的所有进程信息，还会显示一个进程会被启动多少次，因为没处理的异常。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pm2 list\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"显示应用程序详细信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#显示应用程序详细信息"}},[s._v("#")]),s._v(" 显示应用程序详细信息")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pm2 show <appName> [options] 显示指定应用详情\npm2 show [Name]   //根据name查看\npm2 show [ID]    //根据id查看\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"停止指定应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止指定应用"}},[s._v("#")]),s._v(" 停止指定应用")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pm2 stop <appName> [options] 停止指定应用\npm2 stop all    //停止所有应用/进程\npm2 stop [AppName]  //根据应用名停止指定应用\npm2 stop [ID]    //根据应用id停止指定应用\npm2 stop 0 停止指定的进程\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"重启应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启应用"}},[s._v("#")]),s._v(" 重启应用")]),s._v(" "),t("p",[s._v("pm2 reload|restart "),t("appName",[s._v(" [options] 重启指定应用")])],1),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pm2 restart app.js    //同时杀死并重启所有进程，短时间内服务不可用,生成环境慎用\npm2 reload app.js    //重新启动所有进程，0秒重启，始终保持至少一个进程在运行\npm2 gracefulReload all  //以群集模式重新加载所有应用程序\npm2 restart all 重启所有进程\npm2 restart 0 重启指定的进程\npm2 reload all 0秒停机重载进程 (用于 NETWORKED 进程)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"启动静态服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动静态服务器"}},[s._v("#")]),s._v(" 启动静态服务器")]),s._v(" "),t("p",[s._v("pm2 serve ./dist 8080将目录dist作为静态服务器根目录，端口为8080")]),s._v(" "),t("h3",{attrs:{id:"删除应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除应用"}},[s._v("#")]),s._v(" 删除应用")]),s._v(" "),t("p",[t("em",[t("strong",[s._v("pm2 delete "),t("appName",[s._v(" [options]")])],1)])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("删除指定应用;如果修改了应用配置行为，需要先删除应用，重新启动后方才会生效，如修改脚本入口文件；\npm2 delete all        //关闭并删除应用/杀死全部进\npm2 delete [AppName]    //根据应用名关闭并删除应用\npm2 delete [ID]      //根据应用ID关闭并删除应用\npm2 delete 0 杀死指定的进程\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"pm2-kill"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-kill"}},[s._v("#")]),s._v(" pm2 kill")]),s._v(" "),t("h3",{attrs:{id:"查看指定应用的日志-即标准输出和标准错误"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看指定应用的日志-即标准输出和标准错误"}},[s._v("#")]),s._v(" 查看指定应用的日志，即标准输出和标准错误")]),s._v(" "),t("p",[s._v("pm2 logs "),t("appName")],1),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pm2 logs 显示所有进程日志\npm2 logs      //查看所有应用日志\npm2 logs [Name]  //根据指定应用名查看应用日志\npm2 logs [ID]   //根据指定应用ID查看应用日志\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"监控各个应用进程cpu和memory使用情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控各个应用进程cpu和memory使用情况"}},[s._v("#")]),s._v(" 监控各个应用进程cpu和memory使用情况")]),s._v(" "),t("p",[s._v("pm2 monit 监视每个node进程的CPU和内存的使用情况。")]),s._v(" "),t("h3",{attrs:{id:"pm2-startup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-startup"}},[s._v("#")]),s._v(" pm2 startup")]),s._v(" "),t("p",[s._v("pm2开机自启pm2 startup centos 开启启动设置，此处是CentOS系统，其他系统替换最后一个选项（可选项：ubuntu, centos, redhat, gentoo, systemd, darwin, amazon）\npm2 startup 产生 init 脚本 保持进程活着")]),s._v(" "),t("h3",{attrs:{id:"pm2-web"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-web"}},[s._v("#")]),s._v(" pm2 web")]),s._v(" "),t("p",[s._v("pm2 web 运行健壮的 computer API endpoint")]),s._v(" "),t("h3",{attrs:{id:"pm2-describe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-describe"}},[s._v("#")]),s._v(" pm2 describe")]),s._v(" "),t("p",[s._v("app查看某个进程具体情况")]),s._v(" "),t("h3",{attrs:{id:"pm2-save"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-save"}},[s._v("#")]),s._v(" pm2 save")]),s._v(" "),t("p",[s._v("保存设置")]),s._v(" "),t("h2",{attrs:{id:"pm2配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2配置"}},[s._v("#")]),s._v(" PM2配置")]),s._v(" "),t("p",[t("em",[t("strong",[s._v("开发、生产、测试等环境")])])]),s._v(" "),t("p",[s._v("创建pm2.config.js文件：（其中name显示为pm2 list中的应用名，script为启动文件相对当前文件位置）")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('module.exports = {\n  apps : [\n      {\n        name: "myapp",//应用名\n        script: "./app.js",//应用文件位置\n        watch: [\n          "server",\n       \t],\n        //watch: true,//监听模式，不能单纯的设置为true，易导致无限重启，因为日志文件在变化，需要排除对其的监听\n        env: {\n            "PORT": 3000,//静态服务器访问端口\n            "NODE_ENV": "development" //启动默认模式\n        },\n        env_production: {\n            "PORT": 80,//静态服务器访问端口\n            "NODE_ENV": "production", //使用production模式 pm2 start pm2.config.js --env production\n        }\n      }\n  ]}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("使用命令pm2 start pm2.config.js --env production，将环境切换到NODE_ENV=production。")])])}),[],!1,null,null,null);a.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{391:function(s,a,e){"use strict";e.r(a);var n=e(42),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"上传文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上传文件"}},[s._v("#")]),s._v(" 上传文件")]),s._v(" "),e("p",[e("code",[s._v("koa-body")]),s._v(" 中间件来处理文件上传。koa-body 是将上传的文件放到了系统的临时文件里，然后我们再从临时文件里读取到 upload/ 目录下。其实 koa-body 还可以通过 formidable.uploadDir 属性直接设置存储目录")]),s._v(" "),e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm install koa-body --save\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"引入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#引入"}},[s._v("#")]),s._v(" 引入")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const koaBody = require('koa-body');\napp.use(koaBody({\n    multipart: true,\n    formidable: {\n        maxFileSize: 200*1024*1024,    // 设置上传文件大小最大限制，默认2M\n        uploadDir: 'upload/',//设置存储目录\n        onFileBegin: (name, file)=>{ // 文件存储之前对文件进行重命名处理 \n            const fileFormat = file.name.split('.');\n            file.name = `${Date.now()}.${fileFormat[fileFormat.length-1]}`\n            file.path = `upload/${file.name}`;\n        }\n    }\n}));\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h2",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),e("p",[s._v("通过ctx.request.files获取上传的文件")]),s._v(" "),e("blockquote",[e("p",[s._v("新版本的koa-body通过ctx.request.files获取上传的文件\n旧版本的koa-body通过ctx.request.body.files获取上传的文件")])]),s._v(" "),e("h2",{attrs:{id:"保存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#保存"}},[s._v("#")]),s._v(" 保存")]),s._v(" "),e("p",[s._v("获取到文件之后，通过fs将文件保存到服务器的指定目录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const path = require('path');\nconst fs = require('fs');\nrouter.post('/uploadfile', async (ctx, next) => {\n  // 上传单个文件\n  const file = ctx.request.files.file; // 获取上传文件\n  // 创建可读流\n  const reader = fs.createReadStream(file.path);\n  const ext = file.name.split('.').pop();//获取上传文件扩展名\n  let filePath = path.join(__dirname, 'public/upload/') + `/${file.name}`;\n  // 创建可写流\n  const upStream = fs.createWriteStream(filePath);\n  // 可读流通过管道写入可写流\n  reader.pipe(upStream);\n  return ctx.body = \"上传成功！\";\n});\nrouter.post('/uploadfiles', async (ctx, next) => {\n  // 上传多个文件\n  const files = ctx.request.files.file; // 获取上传文件\n  for (let file of files) {\n    // 创建可读流\n    const reader = fs.createReadStream(file.path);\n    // 获取上传文件扩展名\n    let filePath = path.join(__dirname, 'public/upload/') + `/${file.name}`;\n    // 创建可写流\n    const upStream = fs.createWriteStream(filePath);\n    // 可读流通过管道写入可写流\n    reader.pipe(upStream);\n  }\n return ctx.body = \"上传成功！\";\n});\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("blockquote",[e("p",[s._v("该方法适用于上传图片、文本文件、压缩文件等。")])])])}),[],!1,null,null,null);a.default=t.exports}}]);
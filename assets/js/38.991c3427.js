(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{399:function(t,e,a){"use strict";a.r(e);var s=a(42),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"用户权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户权限"}},[t._v("#")]),t._v(" 用户权限")]),t._v(" "),a("p",[t._v("mongodb安装后，默认不需要用户登陆，可直接操作数据库，这是在真实生产中是非常危险的，可以通过使用为mongodb创建用户的方式来降低风险。")]),t._v(" "),a("p",[t._v("下面是mongodb中的常用权限：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("权限名")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("read")]),t._v(" "),a("td",[t._v("允许用户读取指定数据库")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("readWrite")]),t._v(" "),a("td",[t._v("允许用户读写指定数据库")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("dbAdmin")]),t._v(" "),a("td",[t._v("允许用户在指定数据库中执行管理函数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("userAdmin")]),t._v(" "),a("td",[t._v("允许用户向system.users集合写入，可以在指定数据库里创建、删除和管理用户")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("cluterAdmin")]),t._v(" "),a("td",[t._v("只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("readAnyDatabase")]),t._v(" "),a("td",[t._v("只在admin数据库中可用，赋予用户所有数据库的读权限")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("readWriteAnyDatabase")]),t._v(" "),a("td",[t._v("只在admin数据库中可用，赋予用户所有数据库的读写权限")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("userAdminAnyDatabase")]),t._v(" "),a("td",[t._v("只在admin数据库中可用，赋予用户所有数据库的userAmin权限")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("dbAdminAnyDatabase")]),t._v(" "),a("td",[t._v("只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("root")]),t._v(" "),a("td",[t._v("只在admin数据库中可用，超级账号，超级权限")])])])]),t._v(" "),a("h2",{attrs:{id:"开启auth参数-认证通过后才能访问数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启auth参数-认证通过后才能访问数据库"}},[t._v("#")]),t._v(" 开启auth参数，认证通过后才能访问数据库")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdn.net/20180718105815985?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW94aWFuZ3ppNTIw/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),a("h2",{attrs:{id:"创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建用户"}},[t._v("#")]),t._v(" 创建用户")]),t._v(" "),a("p",[t._v("先进入mongodb命令行")]),t._v(" "),a("p",[t._v("(1) 选择数据库")]),t._v(" "),a("p",[t._v("use 数据库的名称")]),t._v(" "),a("p",[t._v("使用admin数据库(超级管理员账号必须创建在该数据库上)")]),t._v(" "),a("p",[t._v("(2) 添加用户")]),t._v(" "),a("p",[t._v("db.createUser(用户名,密码,是否只读)")]),t._v(" "),a("p",[t._v('第三个参数"是否只读"默认是 false ，创建的用户可以执行读写，如果是 true ，则创建的用户只能查询，不能修改。')]),t._v(" "),a("p",[t._v("注意点：在创建用户之前，必须先创建一个超级管理员")]),t._v(" "),a("p",[t._v("创建超级用户")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.createUser({"user":"root","pwd":"123456","roles":["root"]})\ndb.createUser({"user":"admin","pwd":"123456","roles":["root"]})\n\nSuccessfully added user: { "user" : "root", "roles" : [ "root" ] }\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("#必须先进入admin库\nuse admin;\n#创建一个用户\ndb.createUser({'user':'root','pwd':'root','roles':[{'role':'root','db':'admin'}],'customData':{'info':'first mongodb user'}});\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/wj204811/wj204811/raw/master/img/20210109214727.png",alt:"image-20210109214720058"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("user：用户名")])]),t._v(" "),a("li",[a("p",[t._v("pwd：密码")])]),t._v(" "),a("li",[a("p",[t._v("roles：指定用户的角色，可以用一个空数组给新用户设定空角色；在roles字段,可以指定内置角色和用户定义的角色。"),a("a",{attrs:{href:"http://docs.mongodb.org/manual/reference/built-in-roles/#built-in-roles",target:"_blank",rel:"noopener noreferrer"}},[t._v("role里的角色"),a("OutboundLink")],1),t._v("可以选：")]),t._v(" "),a("ol",[a("li",[t._v("数据库用户角色：read、readWrite;")]),t._v(" "),a("li",[t._v("数据库管理角色：dbAdmin、dbOwner、userAdmin；")]),t._v(" "),a("li",[t._v("集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；")]),t._v(" "),a("li",[t._v("备份恢复角色：backup、restore；")]),t._v(" "),a("li",[t._v("所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase")]),t._v(" "),a("li",[t._v("超级用户角色：root\n// 这里还有几个角色间接或直接提供了系统超级用户的访问（dbOwner 、userAdmin、userAdminAnyDatabase）")]),t._v(" "),a("li",[t._v("内部角色：__system")])])])]),t._v(" "),a("h2",{attrs:{id:"退出mongo-shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#退出mongo-shell"}},[t._v("#")]),t._v(" 退出mongo shell")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("exit\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"查看已经创建的用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看已经创建的用户"}},[t._v("#")]),t._v(" 查看已经创建的用户：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("show users;\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/wj204811/wj204811/raw/master/img/20210109214827.png",alt:"image-20210109214827027"}})]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 或者使用这条命令也能查询所创建的用户\ndb.system.users.find()\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h2",{attrs:{id:"重启mongodb开启认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启mongodb开启认证"}},[t._v("#")]),t._v(" 重启mongodb开启认证")]),t._v(" "),a("p",[t._v("添加完用户后，如若想要使用用户操作，必须修改MongoDB配置再重启。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("#关闭MongoDB服务\ndb.shutdownServer()\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("修改配置文件")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi /usr/local/mongo/conf/mongodb.conf\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("添加auth=true，然后重启mongodb")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/wj204811/wj204811/raw/master/img/20210109215531.png",alt:"image-20210109215531744"}})]),t._v(" "),a("p",[t._v("进入mongodb命令行，发现所示信息与之前没有开启auth的不一样了，信息少了很多。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/wj204811/wj204811/raw/master/img/20210109215813.png",alt:"image-20210109215813337"}})]),t._v(" "),a("p",[t._v("认证：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("use admin;\ndb.auth('root','123456');\ndb.auth('admin','123456');\n#返回1，登陆成功，返回0，登陆失败\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/wj204811/wj204811/raw/master/img/20210109215956.png",alt:"image-20210109215956151"}})]),t._v(" "),a("h2",{attrs:{id:"修改用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改用户"}},[t._v("#")]),t._v(" 修改用户")]),t._v(" "),a("p",[t._v("修改用户与创建用户语法类似")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("db.updateUser('guest',{'pwd':'123','roles':[{'role':'readAnyDatabase','db':'admin'}]});\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("修改用户密码：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.changeUserPassword("guest","guest");\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"删除用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除用户"}},[t._v("#")]),t._v(" 删除用户")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("db.dropUser('guest');\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);
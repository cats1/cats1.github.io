(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{404:function(s,n,a){"use strict";a.r(n);var e=a(42),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" nginx")]),s._v(" "),a("p",[s._v("Nginx 是一个高性能的HTTP和反向代理服务器，同时也是一个 IMAP/POP3/SMTP 代理服务器。")]),s._v(" "),a("p",[s._v("Nginx（engine x）是一款轻量级的 Web 服务器 、反向代理服务器及电子邮件（IMAP/POP3）代理服务器。")]),s._v(" "),a("p",[s._v("其特点是占有内存少，并发能力强。")]),s._v(" "),a("p",[s._v("常见场景：")]),s._v(" "),a("ul",[a("li",[s._v("静态资源服务器")]),s._v(" "),a("li",[s._v("动态匹配")]),s._v(" "),a("li",[s._v("反向代理")]),s._v(" "),a("li",[s._v("Gzip 压缩")]),s._v(" "),a("li",[s._v("负载均衡")])]),s._v(" "),a("blockquote",[a("p",[s._v("Nginx 安装目录下的"),a("code",[s._v("nginx.conf")]),s._v("就是Nginx全局的配置文件，我们主要修改这里的内容。"),a("code",[s._v("nginx.conf.default")]),s._v("作为配置文件的备份。")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v('# 设置工作进程的数量\nworker_processes  1;\n# 处理连接\nevents {\n    # 设置连接数\n    worker_connections  1024;\n}\nhttp {\n\t#文件拓展名查找集合\n    include       mime.types;\n    # 当查找不到对应类型的时候默认值\n    default_type  application/octet-stream;\n    # 日志格式，定义别名为 main\n    #log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n    #                  \'$status $body_bytes_sent "$http_referer" \'\n    #                  \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    # 指定日志输入目录\n    #access_log  logs/access.log  main;\n\n    # 调用 sendfile 系统传输文件\n    sendfile        on;\n    #tcp_nopush     on;\n\n    # 客户端与服务器连接超时时间，超时自动断开\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    # 开启gizip 压缩\n    #gzip  on;\n\n    # 虚拟主机\n    server {\n        listen       8080;#监听的端口\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        # 路由\n        location / { #location表示路径匹配\n                root   html;#root表示寻找文件夹的路径\n                index  index.html index.htm;#index表示在root已经定义的文件夹下面的具体文件\n            }\n        \n    }\n\n    # 引入其他的配置文件\n    include servers/*;\n }\n')])])]),a("h2",{attrs:{id:"搭建静态站点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建静态站点"}},[s._v("#")]),s._v(" 搭建静态站点")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 虚拟主机server块\nserver {\n    # 端口\n    listen   8080;\n    # 匹配请求中的host值\n    server_name  localhost;\n    \n    # 监听请求路径\n    location / {\n        # 查找目录\n        root /source;\n        # 默认查找\n        index index.html index.htm;\n    }\n}\n#另一种写法\nserver {\n    server_name localhost;\n    listen 8080;\n    root /home;\n\n    location / {\n        #try_files是表示寻找文件 $uri表示root已经定义的变量\n        #下面用来两个$uri是因为有时候html会引入其他css或者js文件，第一个$uri表示在当前文件夹下面寻找，第二个$uri表示精确找到html文件\n        try_files $uri $uri/ /index.html;\n    }\n}\n\n作者：山黎\n链接：https://juejin.cn/post/6844904090195984397\n来源：掘金\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。\nworker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    gzip on;\n    gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/javascript image/jpeg image/gif image/png;\n    gzip_vary on;\n\n    server {\n        listen       80;\n        server_name  static.zp.cn;\n\n        location / {\n            root /app/dist;\n            index index.html;\n            #转发任何请求到 index.html\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br")])]),a("p",[s._v("相关字段")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("server")]),s._v("  配置虚拟主机的相关参数，可以有多个")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("server_name")]),s._v(" 通过请求中的host值 找到对应的虚拟主机的配置")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("location")]),s._v("  配置请求路由，处理相关页面情况")]),s._v(" "),a("p",[a("strong",[s._v("location用来匹配url地址，语法是："),a("code",[s._v("location [ = | ~ | ~\\* | ^~ ] uri{}")]),s._v(" 这里会有四种匹配规则:")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("=")]),s._v(" 该装饰符会精确匹配并终止搜索")]),s._v(" "),a("li",[a("code",[s._v("~")]),s._v(" 该装饰符使用区分大小写的正则表达式匹配")]),s._v(" "),a("li",[a("code",[s._v("~*")]),s._v(" 该装饰符使用不区分大小写的正则表达式匹配")]),s._v(" "),a("li",[a("code",[s._v("^~")]),s._v(" 该装饰符使用在不含正则表达式的uri前，当匹配成功以后，将不会再执行其他的正则表达式的location块")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("root")]),s._v(" 查找资源的路径")])])]),s._v(" "),a("p",[s._v("配置完成后执行 "),a("code",[s._v("nginx -t")]),s._v(" 看是否有错误，如果看到的是下面这种就是成功了")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后执行"),a("code",[s._v("nginx -s reload")]),s._v(" 更新Nginx配置文件")]),s._v(" "),a("p",[s._v("这时候打开浏览器  输入 localhost:8080  应该就能看到你的页面了")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("nginx -t")]),s._v(" 检查配置文件是否有语法错误\n"),a("code",[s._v("nginx -s reload")]),s._v(" 向主进程发送信号，重新加载配置文件\n"),a("code",[s._v("nginx -s stop")]),s._v(" 快速关闭\n"),a("code",[s._v("nginx -s quit")]),s._v(" 等待工作进程处理完成后关闭")])]),s._v(" "),a("h2",{attrs:{id:"搭建文件服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建文件服务器"}},[s._v("#")]),s._v(" "),a("strong",[s._v("搭建文件服务器")])]),s._v(" "),a("p",[s._v("有时候，团队需要归档一些数据或资料，那么文件服务器必不可少。使用 Nginx 可以非常快速便捷的搭建一个简易的文件服务。")]),s._v(" "),a("p",[s._v("Nginx 中的配置要点：")]),s._v(" "),a("ul",[a("li",[s._v("将 autoindex 开启可以显示目录，默认不开启。")]),s._v(" "),a("li",[s._v("将 autoindex_exact_size 开启可以显示文件的大小。")]),s._v(" "),a("li",[s._v("将 autoindex_localtime 开启可以显示文件的修改时间。")]),s._v(" "),a("li",[s._v("root 用来设置开放为文件服务的根路径。")]),s._v(" "),a("li",[s._v("charset 设置为 charset utf-8，gbk，可以避免中文乱码问题。")])]),s._v(" "),a("p",[s._v("一个最简化的配置如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("autoindex on;# 显示目录\nautoindex_exact_size on;# 显示文件大小\nautoindex_localtime on;# 显示文件时间\n\nserver {\n    charset      utf-8,gbk; # windows 服务器下设置后，依然乱码，暂时无解\n    listen       9050 default_server;\n    listen       [::]:9050 default_server;\n    server_name  _;\n    root         /share/fs;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"解决跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决跨域"}},[s._v("#")]),s._v(" "),a("strong",[s._v("解决跨域")])]),s._v(" "),a("p",[s._v("Web 领域开发中，经常采用前后端分离模式。这种模式下，前端和后端分别是独立的 Web 应用程序，例如：后端是 Java 程序，前端是 React 或 Vue 应用。")]),s._v(" "),a("p",[s._v("各自独立的 web app 在互相访问时，势必存在跨域问题。解决跨域问题一般有两种思路：")]),s._v(" "),a("ul",[a("li",[s._v("**CORS，**在后端服务器设置 HTTP 响应头，把你需要允许访问的域名加入 Access-Control-Allow-Origin 中。")]),s._v(" "),a("li",[s._v("**jsonp，**把后端根据请求，构造 json 数据，并返回，前端用 jsonp 跨域。")])]),s._v(" "),a("p",[s._v("这两种思路，本文不展开讨论。需要说明的是，Nginx 根据第一种思路，也提供了一种解决跨域的解决方案。")]),s._v(" "),a("p",[s._v("举例：www.helloworld.com 网站是由一个前端 app ，一个后端 app 组成的。前端端口号为 9000， 后端端口号为 8080。")]),s._v(" "),a("p",[s._v("前端和后端如果使用 HTTP 进行交互时，请求会被拒绝，因为存在跨域问题。来看看，Nginx 是怎么解决的吧。")]),s._v(" "),a("p",[s._v("首先，在 enable-cors.conf 文件中设置 cors：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# allow origin list\nset $ACAO '*';\n\n# set single origin\nif ($http_origin ~* (www.helloworld.com)$) {\n  set $ACAO $http_origin;\n}\n\nif ($cors = \"trueget\") {\n    add_header 'Access-Control-Allow-Origin' \"$http_origin\";\n    add_header 'Access-Control-Allow-Credentials' 'true';\n    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n    add_header 'Access-Control-Allow-Headers' 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';\n}\n\nif ($request_method = 'OPTIONS') {\n  set $cors \"${cors}options\";\n}\n\nif ($request_method = 'GET') {\n  set $cors \"${cors}get\";\n}\n\nif ($request_method = 'POST') {\n  set $cors \"${cors}post\";\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("接下来，在你的服务器中 include enable-cors.conf 来引入跨域配置：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# ----------------------------------------------------\n# 此文件为项目 nginx 配置片段\n# 可以直接在 nginx config 中 include（推荐）\n# 或者 copy 到现有 nginx 中，自行配置\n# www.helloworld.com 域名需配合 dns hosts 进行配置\n# 其中，api 开启了 cors，需配合本目录下另一份配置文件\n# ----------------------------------------------------\nupstream front_server{\n  server www.helloworld.com:9000;\n}\nupstream api_server{\n  server www.helloworld.com:8080;\n}\n\nserver {\n  listen       80;\n  server_name  www.helloworld.com;\n\n  location ~ ^/api/ {\n    include enable-cors.conf;\n    proxy_pass http://api_server;\n    rewrite "^/api/(.*)$" /$1 break;\n  }\n\n  location ~ ^/ {\n    proxy_pass http://front_server;\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("到此，就完成了。")]),s._v(" "),a("h2",{attrs:{id:"动态匹配-请求过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态匹配-请求过滤"}},[s._v("#")]),s._v(" 动态匹配（请求过滤）")]),s._v(" "),a("blockquote",[a("p",[s._v("通常在开发环境或者测试环境的时候呢我们修改了代码，因为浏览器缓存，可能不会生效，需要手动清除缓存，才能看到修改后的效果，这里我们做一个配置让浏览器不缓存相关的资源。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location ~* \\.(js|css|png|jpg|gif)$ {\n    add_header Cache-Control no-store;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("code",[s._v("~* \\.(js|css|png|jpg|gif)$")]),s._v(" 是匹配以相关文件类型然后单独处理。 "),a("code",[s._v("add_header")]),s._v(" 是给请求的响应加上一个头信息"),a("code",[s._v("Cache-Control no-store")]),s._v("，告知浏览器禁用缓存，每次都从服务器获取 效果如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/8/169fc1a508ab1aba?imageView2/0/w/1280/h/960/ignore-error/1",alt:"Cache-Contro"}})]),s._v(" "),a("h4",{attrs:{id:"匹配规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配规则"}},[s._v("#")]),s._v(" 匹配规则")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location = / {\n    [ configuration A ]\n}\n\nlocation / {\n    [ configuration B ]\n}\n\nlocation /documents/ {\n    [ configuration C ]\n}\n\nlocation ^~ /images/ {\n    [ configuration D ]\n}\n\nlocation ~* \\.(gif|jpg|jpeg)$ {\n    [ configuration E ]\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("=")]),s._v(" 表示精确匹配。只有请求的url路径与后面的字符串完全相等时，才会命中（优先级最高）。")]),s._v(" "),a("li",[a("code",[s._v("^~")]),s._v(" 表示如果该符号后面的字符是最佳匹配，采用该规则，不再进行后续的查找。")]),s._v(" "),a("li",[a("code",[s._v("~")]),s._v(" 表示该规则是使用正则定义的，区分大小写。")]),s._v(" "),a("li",[a("code",[s._v("~*")]),s._v(" 表示该规则是使用正则定义的，不区分大小写。")])]),s._v(" "),a("p",[s._v("当然我们还可以通过状态码来过滤请求就像这样")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 通过状态码，返回指定的错误页面\nerror_page 500 502 503 504 /50x.html;\nlocation = /50x.html {\n    root /source/error_page;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),a("p",[s._v("反向代理（Reverse Proxy）方式是指以代理服务器来接受 internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端。")]),s._v(" "),a("p",[s._v("此时代理服务器对外就表现为一个反向代理服务器，如下图：")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/A1HKVXsfHNmfExVw08cor0GwprdeqA8Rax40MniaXLoaiahjDqJmJW6qasgnBzGXRHU3J9aQRxak3mkWY782Ubug/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),s._v(" "),a("h3",{attrs:{id:"反向代理解决跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理解决跨域"}},[s._v("#")]),s._v(" 反向代理解决跨域")]),s._v(" "),a("blockquote",[a("p",[s._v("因为浏览器的"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy",target:"_blank",rel:"noopener noreferrer"}},[s._v("同源策略"),a("OutboundLink")],1),s._v("，当前端域名与后端域名不一致的时候导致请求失败。我们可以通过配置Nginx反向代理来解决。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /api {   \n    # 请求host传给后端\n    proxy_set_header Host $http_host;\n    # 请求ip 传给后端\n    proxy_set_header X-Real-IP $remote_addr;\n    # 请求协议传给后端\n    proxy_set_header X-Scheme $scheme;\n    #后台服务通过x-forward-for知道用户的实际IP\n    proxy_set_header X-Forward-For $proxy_add_x_forward_for;\n    # 路径重写\n    rewrite  /api/(.*)  /$1  break;\n    # 代理服务器\n    proxy_pass http://localhost:9000;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ul",[a("li",[s._v("拦截路径"),a("code",[s._v("/api")]),s._v(", 可以通过正则匹配。")]),s._v(" "),a("li",[a("code",[s._v("proxy_set_header")]),s._v(" 允许重新定义或添加字段传递给代理服务器的请求头。")]),s._v(" "),a("li",[a("code",[s._v("$http_host")]),s._v("、"),a("code",[s._v("$remote_addr")]),s._v("、"),a("code",[s._v("$scheme")]),s._v(" 为Nginx内置变量。")]),s._v(" "),a("li",[a("code",[s._v("rewrite")]),s._v(" 根据rewrite后的请求URI，将路径重写，如：接口路径为 "),a("code",[s._v("/user")]),s._v(", 我们可以请求 "),a("code",[s._v("/api/user")]),s._v("。（为什么需要重写uri？因为在使用Nginx做反向代理的时候，需要匹配到跨域的接口再做转发，为了方便匹配，会人为的在原接口中添加一段路径（或标示， 如例子中的"),a("code",[s._v("api")]),s._v("），因此需要在匹配之后、转发之前把添加的那段去掉，因此需要rewrite。）")]),s._v(" "),a("li",[a("code",[s._v("break")]),s._v(" 继续本次请求后面的处理 ,停止匹配下面的"),a("code",[s._v("location")]),s._v("。需要注意的是与之类似的"),a("code",[s._v("last")]),s._v("执行过程则是停止当前这个请求，并根据rewrite匹配的规则重新发起一个请求，从上到下依次匹配"),a("code",[s._v("location")]),s._v("后面的规则。")]),s._v(" "),a("li",[a("code",[s._v("proxy_pass")]),s._v(" 代理服务器。")])]),s._v(" "),a("blockquote",[a("p",[s._v("原理：Nginx拦截到相关匹配规则, Nginx再将请求转发到"),a("code",[s._v("http://localhost:9000")]),s._v("，Nginx得到请求后再响应到前端，可以直接请求"),a("code",[s._v("/api/user")]),s._v("完成请求。")])]),s._v(" "),a("h3",{attrs:{id:"实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),a("p",[s._v("我们先实现一个小目标：不考虑复杂的配置，仅仅是完成一个 HTTP 反向代理。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#设定实际的服务器列表\nupstream zp_server1{\n  server 127.0.0.1:8089;\n}\n#反向代理的路径（和 upstream 绑定），location 后面设置映射的路径\nlocation / {\n  proxy_pass http://zp_server1;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("HTTPS反向代理")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("网站有多个 webapp 的配置")])]),s._v(" "),a("p",[s._v("当一个网站功能越来越丰富时，往往需要将一些功能相对独立的模块剥离出来，独立维护。这样的话，通常，会有多个 webapp。")]),s._v(" "),a("p",[s._v("**举个例子：**假如 www.helloworld.com 站点有好几个 webapp，finance（金融）、product（产品）、admin（用户中心）。")]),s._v(" "),a("p",[s._v("访问这些应用的方式通过上下文（context）来进行区分：")]),s._v(" "),a("ul",[a("li",[s._v("www.helloworld.com/finance/")]),s._v(" "),a("li",[s._v("www.helloworld.com/product/")]),s._v(" "),a("li",[s._v("www.helloworld.com/admin/")])]),s._v(" "),a("p",[s._v("我们知道，HTTP 的默认端口号是 80，如果在一台服务器上同时启动这 3 个 webapp 应用，都用 80 端口，肯定是不成的。所以，这三个应用需要分别绑定不同的端口号。")]),s._v(" "),a("p",[s._v("那么，问题来了，用户在实际访问 www.helloworld.com 站点时，访问不同 webapp，总不会还带着对应的端口号去访问吧。所以，你再次需要用到反向代理来做处理。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http {\n    #此处省略一些基本配置\n\n    upstream product_server{\n        server www.helloworld.com:8081;\n    }\n\n    upstream admin_server{\n        server www.helloworld.com:8082;\n    }\n\n    upstream finance_server{\n        server www.helloworld.com:8083;\n    }\n\n    server {\n        #此处省略一些基本配置\n        #默认指向product的server\n        location / {\n            proxy_pass http://product_server;\n        }\n\n        location /product/{\n            proxy_pass http://product_server;\n        }\n\n        location /admin/ {\n            proxy_pass http://admin_server;\n        }\n\n        location /finance/ {\n            proxy_pass http://finance_server;\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("h2",{attrs:{id:"配置gzip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置gzip"}},[s._v("#")]),s._v(" 配置Gzip")]),s._v(" "),a("p",[s._v("开发过程中难免用到一些成熟的框架，或者插件，这些外部的依赖，有时候体积比较大，导致页面响应缓慢，我们可以用打包工具(webpack, rollup)，将代码进行压缩，以缩小代码体积。 开启Nginx Gzip压缩功能。需要注意的是 Gzip 压缩功能需要浏览器跟服务器都支持，即服务器压缩，浏览器解析。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("查看浏览器支持情况，确定 "),a("em",[s._v("请求头")]),s._v(" 中的"),a("code",[s._v("Accept-Encoding")]),s._v("字段")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/11/16a0a18ea2c217b7?imageView2/0/w/1280/h/960/ignore-error/1",alt:"gzip浏览器支持"}})])]),s._v(" "),a("li",[a("p",[s._v("确定浏览器支持，我们就可以在Nginx中配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    # 开启gzip 压缩\n    gzip on;\n    # 设置gzip所需的http协议最低版本 （HTTP/1.1, HTTP/1.0）\n    gzip_http_version 1.1;\n    # 设置压缩级别，压缩级别越高压缩时间越长  （1-9）\n    gzip_comp_level 4;\n    # 设置压缩的最小字节数， 页面Content-Length获取\n    gzip_min_length 1000;\n    # 设置压缩文件的类型  （text/html)\n    gzip_types text/plain application/javascript text/css;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("查看配置是否生效，查看 "),a("em",[s._v("响应头")]),s._v(" 中的"),a("code",[s._v("Content-Encoding")]),s._v("字段，值为 "),a("code",[s._v("gzip")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/11/16a0a18ea2a3f84b?imageView2/0/w/1280/h/960/ignore-error/1",alt:"gzip生效"}})])])]),s._v(" "),a("h2",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),a("p",[s._v("代理仅仅指向一个服务器。但是，网站在实际运营过程中，大部分都是以集群的方式运行，这时需要使用负载均衡来分流。Nginx 也可以实现简单的负载均衡功能。")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/A1HKVXsfHNmfExVw08cor0GwprdeqA8R4jtibgrYnXXZmZI2xVhXQyQCyvCWMtQDOtjOv2zrpGlkwcFd2VYqN8Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),s._v(" "),a("p",[s._v("假设这样一个应用场景：将应用部署在 192.168.1.11:80、192.168.1.12:80、192.168.1.13:80 三台 Linux 环境的服务器上。网站域名叫  www.helloworld.com，公网 IP 为 192.168.1.11。")]),s._v(" "),a("p",[s._v("顾名思义，负载均衡即是将负载分摊到不同的服务单元，既保证服务的可用性，又保证响应足够快，给用户很好的体验。")]),s._v(" "),a("p",[s._v("负载均衡是Nginx 比较常用的一个功能，可优化资源利用率，最大化吞吐量，减少延迟，确保容错配置，将流量分配到多个后端服务器。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Syntax:\tupstream name { ... }\nDefault: —\nContext: stream\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("使用nginx实现负载均衡需要proxy模块和upstream模块搭配实现，upstream将启用一个新的配置区域，在该区域定义了一组上游服务器。")]),s._v(" "),a("p",[s._v("这里举出常用的几种策略")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("轮询")]),s._v("（默认），请求过来后，Nginx 随机分配流量到任一服务器")]),s._v(" "),a("p",[s._v("每个请求按照时间顺序分别分配到其他后台服务器，如果设置down则表示服务器暂时停机不作使用")]),s._v(" "),a("p",[s._v("设置backup则表示其他所有非backup状态的主机在down或者忙的时候才会访问这个backup状态的主机")]),s._v(" "),a("p",[s._v("设置max_fails表示最大失败数，超过次数则暂时停机")]),s._v(" "),a("p",[s._v("设置fail_timeout表示如果请求受理失败，则暂停指定的多少秒以后重新发起请求")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("upstream myserver{\n    server localhost:4001 down;\n    server localhost:4002 max_fails=3 fail_timeout=20s;\n    server localhost:4003 backup;\n}\n\nupstream bck_testing_01 {\n  # 默认所有服务器权重为 1\n  server 192.168.250.220:8080\n  server 192.168.250.221:8080\n  server 192.168.250.222:8080\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("weight=number")]),s._v(" 设置服务器的权重，默认为1，权重大的会被优先分配。weight权重分配")]),s._v(" "),a("p",[s._v("指定轮询几率，权重跟轮询几率成正比,用来解决服务器性能不均的问题")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("weight权重分配\nupstream myserver{\n    server localhost:4001 weight=3;\n    server localhost:4002 weight=5;\n    server localhost:4003 weight=3;\n}\nupstream bck_testing_01 {\n  server 192.168.250.220:8080   weight=3\n  server 192.168.250.221:8080              # default weight=1\n  server 192.168.250.222:8080              # default weight=1\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("backup")]),s._v(" 标记为备份服务器。当主服务器不可用时，将传递与备份服务器的连接。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n\nupstream backend {\n    server 127.0.0.1:3000 backup;\n    server 127.0.0.1:3001;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("ip_hash")]),s._v(" 保持会话，保证同一客户端始终访问一台服务器。")]),s._v(" "),a("p",[s._v("每个请求按照ip的hash分配，即每个用户都固定使用一个后台服务器，用来解决session不同的问题")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("upstream myserver{\n    ip_hash;\n    server localhost:4001;\n    server localhost:4002;\n    server localhost:4003;\n}\n\nupstream backend {\n    ip_hash;  \n    server 127.0.0.1:3000 backup;\n    server 127.0.0.1:3001;\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("普通 Hash")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("upstream bck_testing_01 {\n  hash $request_uri;\n  # with default weight for all (weight=1)\n  server 192.168.250.220:8080\n  server 192.168.250.221:8080\n  server 192.168.250.222:8080\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("least_conn")]),s._v(" 加权最少连接，优先分配最少连接数的服务器，避免服务器超载请求过多。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("upstream bck_testing_01 {\n  least_conn;\n\n  server 192.168.250.220:8080   weight=3\n  server 192.168.250.221:8080              # default weight=1\n  server 192.168.250.222:8080              # default weight=1\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("fair(第三方包，需要自己去下载配置)")]),s._v(" "),a("p",[s._v("按后台服务器的响应时间来分配请求，响应时间少的优先分配")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("upstream myserver{\n    server localhost:4001;\n    server localhost:4002;\n    server localhost:4003;\n    fair;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("最后使用代理")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server{\n\n    listen 80;\n    server_name localhost;\n\n    location / {\n        proxy_pass http://myserver;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])]),s._v(" "),a("p",[s._v("当我们需要代理一个集群时候可以通过下面这种方式实现。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http {\n    upstream backend {\n        server 127.0.0.1:3000;\n        server 127.0.0.1:3001;\n    }\n    server {\n        listen      9000;\n        server_name localhost;\n        \n        location / {\n            proxy_set_header Host $http_host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Scheme $scheme;\n            \n            proxy_pass backend; \n        }\n    }\n}\nhttp {\n     #设定 mime 类型，类型由 mime.type 文件定义\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n    #设定日志格式\n    access_log    /var/log/nginx/access.log;\n\n    #设定负载均衡的服务器列表\n    upstream load_balance_server {\n        #weigth 参数表示权值，权值越高被分配到的几率越大\n        server 192.168.1.11:80   weight=5;\n        server 192.168.1.12:80   weight=1;\n        server 192.168.1.13:80   weight=6;\n    }\n\n   #HTTP 服务器\n   server {\n        #侦听 80 端口\n        listen       80;\n\n        #定义使用 www.xx.com 访问\n        server_name  www.helloworld.com;\n\n        #对所有请求进行负载均衡请求\n        location / {\n            root        /root;                 #定义服务器的默认网站根目录位置\n            index       index.html index.htm;  #定义首页索引文件的名称\n            proxy_pass  http://load_balance_server ;#请求转向load_balance_server 定义的服务器列表\n\n            #以下是一些反向代理的配置(可选择性配置)\n            #proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            #后端的 Web 服务器可以通过 X-Forwarded-For 获取用户真实 IP\n            proxy_set_header X-Forwarded-For $remote_addr;\n            proxy_connect_timeout 90;          #Nginx 跟后端服务器连接超时时间（代理连接超时）\n            proxy_send_timeout 90;             #后端服务器数据回传时间（代理发送超时）\n            proxy_read_timeout 90;             #连接成功后，后端服务器响应时间（代理接收超时）\n            proxy_buffer_size 4k;              #设置代理服务器（Nginx）保存用户头信息的缓冲区大小\n            proxy_buffers 4 32k;               #proxy_buffers 缓冲区，网页平均在 32k 以下的话，这样设置\n            proxy_busy_buffers_size 64k;       #高负荷下缓冲大小（proxy_buffers*2）\n            proxy_temp_file_write_size 64k;    #设定缓存文件夹大小，大于这个值，将从 upstream 服务器传\n\n            client_max_body_size 10m;          #允许客户端请求的最大单文件字节数\n            client_body_buffer_size 128k;      #缓冲区代理缓冲用户端请求的最大字节数\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br")])]),a("h2",{attrs:{id:"静态加载文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态加载文件"}},[s._v("#")]),s._v(" 静态加载文件")]),s._v(" "),a("p",[s._v("在服务器的文件夹里偶尔会存放文件、图片，这个时候想要在本地直接查看文件但是又不想登录服务器去看，就需要用nginx去静态加载文件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server{\n    server_name localhost;\n    listen 80;\n\n    location /image/{\n        autoindex on; #打开自动列表\n        alias /home/image/; #将/image/映射到/home/image/文件夹\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"https配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#https配置"}},[s._v("#")]),s._v(" https配置")]),s._v(" "),a("p",[s._v("https是基于http协议的，使用SSL或TLS进行加密处理数据、验证对方身份和数据完整性保护。")]),s._v(" "),a("ol",[a("li",[s._v("https里客户端(浏览器)向服务端发送信息，客户端用服务端的公钥加密，然后传输到服务端以后，服务端用私钥解密。")]),s._v(" "),a("li",[s._v("服务端向客户端发送信息，服务端通过私钥加密，然后传输到客户端，客户端再用服务端的公钥解密。")])]),s._v(" "),a("p",[s._v("一般是需要申请CA的https证书的。")]),s._v(" "),a("p",[s._v("假设我已经申请证书成功了，证书分别是 /home/test.pem和/home/test.key，我的服务器备案网址是www.example.cn，现在开始配置nginx的https:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n       server_name localhost www.example.cn example.cn;\n        listen 80;\n        listen [::]:80; #配置https2的ipv6地址\n        listen 443 ssl http2; #配置443端口监听https加密\n        listen [::]:443 ssl http2;\n\n        ssl_certificate  /home/test.pem;\n        ssl_certificate_key /home/test.key;\n\n        ssl_session_cache shared:SSL:10m;#配置共享会话缓存大小\n        ssl_session_timeout 5m; #配置会话超时时间\n\n        add_header X-xss-Protection 1;#防止xss攻击\n\n        location / {\n            root /home;\n            index index.html;\n        }\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h2",{attrs:{id:"优化配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化配置"}},[s._v("#")]),s._v(" 优化配置")]),s._v(" "),a("h3",{attrs:{id:"打包压缩文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包压缩文件"}},[s._v("#")]),s._v(" 打包压缩文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('http{\n\n    gzip on; #开启gzip压缩输出\n    gzip_min_length 1k;#最小压缩文件大小\n    gzip buffers 4 16k;#压缩缓冲区\n    gzip_comp_level 9; #压缩的等级，数值为1-9的任意值，9是最慢但压缩比最大\n    #压缩的文本类型\n    gzip_types  text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;\n    gzip_disable "MSIE[1-6]\\."; #IE6客户端以下禁用压缩\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"worker机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#worker机制"}},[s._v("#")]),s._v(" worker机制")]),s._v(" "),a("p",[s._v("每个worker就是一个独立的进程，但每个进程里只有一个主线程，通过异步非堵塞的方式来方式来处理请求，每个worker的线程可以发挥服务器的一个cpu，所以设置worker数和服务器的cpu数相等是最合适的，再设置worker_connection连接数，表示最大的并发数。假如每次服务器要占三个连接，那么最大并发量是worker_processes * woker_connection/3，假如设置了反向代理服务器，则最大并发量是worker_processes * woker_connection/6，因为每个并发会建立前端和后台的连接，占用两个连接。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http{\n    worker_processes 4;\n    worker_cpu_affinity 0001 0010 0100 1000; #分配cpu块\n\n    pid logs/nginx.pid; #进程文件\n\n    worker_rlimit_nofile 1024; #一个nginx进程最多打开多少文件\n\n    events{\n        use epoll;#使用多路复用方式，提高nginx性能\n        worker_connection 1024; #单个process的最大并发量\n    }\n\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"nginx命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx命令"}},[s._v("#")]),s._v(" nginx命令")]),s._v(" "),a("p",[s._v("详细安装方法请参考：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("https://github.com/dunwu/nginx-tutorial/blob/master/docs/nginx-ops.md\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Nginx 的使用比较简单，就是几条命令。")]),s._v(" "),a("p",[s._v("常用到的命令如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -s stop       快速关闭 Nginx，可能不保存相关信息，并迅速终止 Web 服务。\nnginx -s quit       平稳关闭 Nginx，保存相关信息，有安排的结束 Web 服务。\nnginx -s reload     因改变了 Nginx 相关配置，需要重新加载配置而重载。\nnginx -s reopen     重新打开日志文件。\nnginx -c filename   为 Nginx 指定一个配置文件，来代替缺省的。\nnginx -t            不运行，仅仅测试配置文件。Nginx 将检查配置文件的语法的正确性，并尝试打开配置文件中所引用到的文件。\nnginx -v            显示 Nginx 的版本。\nnginx -V            显示 Nginx 的版本，编译器版本和配置参数。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("如果不想每次都敲命令，可以在 Nginx 安装目录下新添一个启动批处理文件 startup.bat，双击即可运行。")]),s._v(" "),a("p",[s._v("内容如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("@echo off\nrem 如果启动前已经启动 Nginx 并记录下 pid 文件，会 kill 指定进程\nnginx.exe -s stop\n\nrem 测试配置文件语法正确性\nnginx.exe -t -c conf/nginx.conf\n\nrem 显示版本信息\nnginx.exe -v\n\nrem 按照指定配置去启动 Nginx\nnginx.exe -c conf/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("如果是运行在 Linux 下，写一个 shell 脚本，大同小异。")]),s._v(" "),a("p",[s._v("其他的停止nginx 方式：")]),s._v(" "),a("p",[s._v("ps -ef | grep nginx")]),s._v(" "),a("p",[s._v("kill -QUIT 主进程号   ：从容停止Nginx\nkill -TERM 主进程号   ：快速停止Nginx\npkill -9 nginx     ：强制停止Nginx")]),s._v(" "),a("p",[s._v("./nginx -s quit:此方式停止步骤是待nginx进程处理任务完毕进行停止。")]),s._v(" "),a("p",[s._v("./nginx -s stop:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。")])])}),[],!1,null,null,null);n.default=t.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{375:function(v,_,t){"use strict";t.r(_);var e=t(42),a=Object(e.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"restful-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#restful-api"}},[v._v("#")]),v._v(" Restful API")]),v._v(" "),t("p",[t("strong",[v._v("Rest是web服务的一种架构风格，一种设计风格，是一种思想；同时Rest不是针对某一种编程语言的。")])]),v._v(" "),t("p",[t("strong",[v._v("RESTful架构")]),v._v("，就是目前最流行的一种互联网软件架构。它结构清晰、符合标准、易于理解、扩展方便。")]),v._v(" "),t("p",[t("strong",[v._v("REST（Representational State Transfer）")])]),v._v(" "),t("p",[v._v('REST的名称"表现层状态转化"中，省略了主语。“表现层"其实指的是"资源”（Resources）的"表现层"。')]),v._v(" "),t("p",[t("strong",[v._v("资源（Resources）")])]),v._v(" "),t("ul",[t("li",[v._v('所谓"资源"，就是网络上的一个实体，或者说是网络上的一个具体信息。它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的实在。你可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的URI。要获取这个资源，访问它的URI就可以，因此URI就成了每一个资源的地址或独一无二的识别符。')]),v._v(" "),t("li",[v._v('所谓"上网"，就是与互联网上一系列的"资源"互动，调用它的URI。')])]),v._v(" "),t("p",[t("strong",[v._v("表现层（Representation）")])]),v._v(" "),t("p",[v._v('"资源"是一种信息实体，它可以有多种外在表现形式。'),t("strong",[v._v('我们把"资源"具体呈现出来的形式，叫做它的"表现层"（Representation）。')])]),v._v(" "),t("p",[v._v("比如，文本可以用"),t("code",[v._v("txt格式")]),v._v("表现，也可以用"),t("code",[v._v("HTML格式")]),v._v("、"),t("code",[v._v("XML格式")]),v._v("、"),t("code",[v._v("JSON格式")]),v._v("表现，甚至可以采用二进制格式；图片可以用"),t("code",[v._v("JPG格式")]),v._v("表现，也可以用"),t("code",[v._v("PNG格式")]),v._v("表现。")]),v._v(" "),t("p",[t("code",[v._v("URL")]),v._v("只代表资源的实体，不代表它的形式。严格地说，有些网址最后的"),t("code",[v._v('".html"')]),v._v('后缀名是不必要的，因为这个后缀名表示格式，属于"表现层"范畴，而URI应该只代表"资源"的位置。它的具体表现形式，应该在HTTP请求的头信息中用'),t("code",[v._v("Accept")]),v._v("和"),t("code",[v._v("Content-Type")]),v._v('字段指定，这两个字段才是对"表现层"的描述。')]),v._v(" "),t("p",[t("strong",[v._v("状态转化（State Transfer）")])]),v._v(" "),t("p",[v._v("访问一个网站，就代表了客户端和服务器的一个互动过程。在这个过程中，势必涉及到数据和状态的变化。")]),v._v(" "),t("p",[v._v("互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，"),t("strong",[v._v('如果客户端想要操作服务器，必须通过某种手段，让服务器端发生"状态转化"（State Transfer）。而这种转化是建立在表现层之上的，所以就是"表现层状态转化"。')])]),v._v(" "),t("p",[v._v("客户端用到的手段，只能是HTTP协议。具体来说，就是HTTP协议里面，四个表示操作方式的动词："),t("code",[v._v("GET")]),v._v("、"),t("code",[v._v("POST")]),v._v("、"),t("code",[v._v("PUT")]),v._v("、"),t("code",[v._v("DELETE")]),v._v("。四个表示操作方式对应对应四种基本操作")]),v._v(" "),t("ul",[t("li",[t("strong",[v._v("GET")]),v._v(" 获取资源")]),v._v(" "),t("li",[t("strong",[v._v("POST")]),v._v(" 新建资源")]),v._v(" "),t("li",[t("strong",[v._v("PUT")]),v._v(" 更新资源")]),v._v(" "),t("li",[t("strong",[v._v("DELETE")]),v._v(" 删除资源")])]),v._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200909222511315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MDE5Njk4,size_16,color_FFFFFF,t_70#pic_center",alt:"在这里插入图片描述"}})]),v._v(" "),t("p",[v._v("综合上面，"),t("code",[v._v("RESTful架构")]),v._v("的内容：")]),v._v(" "),t("ol",[t("li",[v._v("每一个URI代表一种资源；")]),v._v(" "),t("li",[v._v("客户端和服务器之间，传递这种资源的某种表现层；")]),v._v(" "),t("li",[v._v('客户端通过四个HTTP动词，对服务器端资源进行操作，实现"表现层状态转化"。')])]),v._v(" "),t("h2",{attrs:{id:"restful-api-设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#restful-api-设计"}},[v._v("#")]),v._v(" RESTful API 设计")]),v._v(" "),t("h3",{attrs:{id:"api与用户的通信协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api与用户的通信协议"}},[v._v("#")]),v._v(" API与用户的通信协议")]),v._v(" "),t("p",[v._v("采用"),t("code",[v._v("HTTPs")]),v._v("协议")]),v._v(" "),t("h3",{attrs:{id:"域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#域名"}},[v._v("#")]),v._v(" 域名")]),v._v(" "),t("p",[v._v("用"),t("code",[v._v("api")]),v._v("关键字标识接口"),t("code",[v._v("url")])]),v._v(" "),t("p",[v._v("示例：")]),v._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[v._v("   # 应该尽量将API部署在专用域名之下。\n   # 表示前后端数据交互\n   https://api.example.com\n   \n   # 应该尽量将API部署在专用域名之下。\n   https://example.org/api/\n")])]),v._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[v._v("1")]),t("br"),t("span",{staticClass:"line-number"},[v._v("2")]),t("br"),t("span",{staticClass:"line-number"},[v._v("3")]),t("br"),t("span",{staticClass:"line-number"},[v._v("4")]),t("br"),t("span",{staticClass:"line-number"},[v._v("5")]),t("br"),t("span",{staticClass:"line-number"},[v._v("6")]),t("br")])]),t("h3",{attrs:{id:"路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路径"}},[v._v("#")]),v._v(" 路径")]),v._v(" "),t("p",[v._v('路径又称"终点"（endpoint），表示API的具体网址。')]),v._v(" "),t("p",[v._v('在RESTful架构中，每个网址代表一种资源（resource），所以网址中不能有动词，只能有名词，而且所用的名词往往与数据库的表格名对应。一般来说，数据库中的表都是同种记录的"集合"（collection），所以API中的名词也应该使用复数。')]),v._v(" "),t("p",[v._v("举例来说，有一个API提供动物园（zoo）的信息，还包括各种动物和雇员的信息，则它的路径应该设计成下面这样。")]),v._v(" "),t("blockquote",[t("ul",[t("li",[v._v("https://api.example.com/v1/zoos")]),v._v(" "),t("li",[v._v("https://api.example.com/v1/animals")]),v._v(" "),t("li",[v._v("https://api.example.com/v1/employees")])])]),v._v(" "),t("blockquote",[t("p",[v._v("使用中划线 - ，而不是使用下划线 _ 来提高uri的可读性")]),v._v(" "),t("p",[v._v("在uri中使用小写字母")]),v._v(" "),t("p",[v._v("不要在URI中使用尾部正斜杠（/）")]),v._v(" "),t("p",[v._v("URI的路径部分使用正斜杠（/）字符表示资源之间的层次关系。")]),v._v(" "),t("p",[v._v("切勿在URI中使用CRUD函数名称")])]),v._v(" "),t("h3",{attrs:{id:"http动词"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http动词"}},[v._v("#")]),v._v(" HTTP动词")]),v._v(" "),t("p",[v._v("对于资源的具体操作类型，由HTTP动词表示。")]),v._v(" "),t("p",[v._v("Rest架构：")]),v._v(" "),t("blockquote",[t("p",[v._v("GET "),t("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8080%2Fadmin%2Fuser",target:"_blank",rel:"noopener noreferrer"}},[v._v("http://localhost:8080/admin/user"),t("OutboundLink")],1),v._v(" （查询用户）从服务器取出资源（一项或多项）。")]),v._v(" "),t("p",[v._v("POST "),t("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8080%2Fadmin%2Fuser",target:"_blank",rel:"noopener noreferrer"}},[v._v("http://localhost:8080/admin/user"),t("OutboundLink")],1),v._v(" （新增用户）在服务器新建一个资源。")]),v._v(" "),t("p",[v._v("PUT "),t("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8080%2Fadmin%2Fuser",target:"_blank",rel:"noopener noreferrer"}},[v._v("http://localhost:8080/admin/user"),t("OutboundLink")],1),v._v(" （更新用户）在服务器更新资源（客户端提供改变后的完整资源）。")]),v._v(" "),t("p",[v._v("PATCH "),t("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8080%2Fadmin%2Fuser",target:"_blank",rel:"noopener noreferrer"}},[v._v("http://localhost:8080/admin/user"),t("OutboundLink")],1),v._v(" （更新用户）在服务器更新资源（客户端提供改变的属性）。")]),v._v(" "),t("p",[v._v("DELETE "),t("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8080%2Fadmin%2Fuser",target:"_blank",rel:"noopener noreferrer"}},[v._v("http://localhost:8080/admin/user"),t("OutboundLink")],1),v._v(" （删除用户）从服务器删除资源。")])]),v._v(" "),t("blockquote",[t("p",[v._v("GET（SELECT）：从服务器取出资源（一项或多项）。\nPOST（CREATE）：在服务器新建一个资源。\nPUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。\nPATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。\nDELETE（DELETE）：从服务器删除资源。")])]),v._v(" "),t("p",[v._v("还有两个不常用的HTTP动词。")]),v._v(" "),t("blockquote",[t("p",[v._v("HEAD：获取资源的元数据。")]),v._v(" "),t("p",[v._v("OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。")])]),v._v(" "),t("p",[v._v("put与patch选择")]),v._v(" "),t("p",[v._v("假设我们有一个UserInfo，里面有userId， userName， userGender等10个字段。可你的编辑功能因为需求，在某个特别的页面里只能修改userName，这时候的更新怎么做？patch诞生，只传一个userName到指定资源去，表示该请求是一个局部更新，后端仅更新接收到的字段。")]),v._v(" "),t("p",[v._v("而put虽然也是更新资源，但要求前端提供的一定是一个完整的资源对象，理论上说，如果你用了put，但却没有提供完整的UserInfo，那么缺了的那些字段应该被清空")]),v._v(" "),t("p",[v._v("在Restful架构中，每个网址uri代表一种资源，所以网址中不要有动词，而且用到的名词往往和数据库中的表名相对应。")]),v._v(" "),t("p",[v._v('一般来说，数据库中的表都是同种记录的"集合"，所以API中的名词也应该使用复数，如：http://api.kaky.cn/v2/members')]),v._v(" "),t("p",[v._v("例子：")]),v._v(" "),t("blockquote",[t("ul",[t("li",[v._v("GET /zoos：列出所有动物园")]),v._v(" "),t("li",[v._v("POST /zoos：新建一个动物园")]),v._v(" "),t("li",[v._v("GET /zoos/ID：获取某个指定动物园的信息")]),v._v(" "),t("li",[v._v("PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）")]),v._v(" "),t("li",[v._v("PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）")]),v._v(" "),t("li",[v._v("DELETE /zoos/ID：删除某个动物园")]),v._v(" "),t("li",[v._v("GET /zoos/ID/animals：列出某个指定动物园的所有动物")]),v._v(" "),t("li",[v._v("DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物")])])]),v._v(" "),t("p",[v._v("下面列举一些例子")]),v._v(" "),t("blockquote",[t("p",[v._v("GET /members：列出所有会员")]),v._v(" "),t("p",[v._v("GET /members/{id}：获取某个指定会员的信息")]),v._v(" "),t("p",[v._v("POST /members：新建一个会员")]),v._v(" "),t("p",[v._v("PUT /members/{id}：更新某个指定会员的信息")]),v._v(" "),t("p",[v._v("DELETE /members/{id}：删除某个指定的会员")])]),v._v(" "),t("p",[v._v("特殊的接口可以出现动词，因为这些接口一般没有一个明确的资源，或是动词就是接口的核心含义")]),v._v(" "),t("blockquote",[t("ul",[t("li",[v._v("https://api.baidu.com/place/search")]),v._v(" "),t("li",[v._v("https://api.baidu.com/login")])])]),v._v(" "),t("p",[v._v("在实际情况中，我们很少会获取所有资源，而通常会进行排序、过滤、限制等，如：")]),v._v(" "),t("blockquote",[t("p",[v._v("?limit=10：指定返回记录的数量")]),v._v(" "),t("p",[v._v("?offset=10：指定返回记录的开始位置。")]),v._v(" "),t("p",[v._v("?page=2&per_page=10：指定第几页，以及每页的记录数。")]),v._v(" "),t("p",[v._v("?sortby=name&order=asc：指定返回结果按照哪个属性排序，以及排序顺序。")]),v._v(" "),t("p",[v._v("?member_type_id=1：指定筛选条件")])]),v._v(" "),t("h3",{attrs:{id:"状态码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#状态码"}},[v._v("#")]),v._v(" 状态码")]),v._v(" "),t("p",[v._v("客户端的每一次请求，服务器都必须给出回应。回应包括HTTP状态码和数据两部分。")]),v._v(" "),t("p",[v._v("使用适合的状态码很重要，而不应该全部都返回状态码 200。")]),v._v(" "),t("p",[v._v("状态码，可根据以下标准按照项目扩展自身状态码。")]),v._v(" "),t("p",[v._v("HTTP状态码就是一个三位数，分成5个类别。")]),v._v(" "),t("blockquote",[t("p",[v._v("1xx：信息，通信传输协议级信息。")]),v._v(" "),t("p",[v._v("2xx：成功，表示客户端的请求已成功接受。")]),v._v(" "),t("p",[v._v("3xx：重定向，表示客户端必须执行一些其他操作才能完成其请求。")]),v._v(" "),t("p",[v._v("4xx：客户端错误，此类错误状态代码指向客户端。")]),v._v(" "),t("p",[v._v("5xx：服务器错误，服务器负责这些错误状态代码。")])]),v._v(" "),t("p",[v._v("总共这五大类总共包含100多种状态码，覆盖了绝大部分可能遇到的情况。每一种状态码都有标准的解释，客户端只需要查看状态码，就可以判断出发生了什么情况，所以服务器应该返回尽可能精确的状态码。")]),v._v(" "),t("p",[v._v("API中不需要1xx状态码，下面介绍一下其他四类状态码的精确含义。")]),v._v(" "),t("p",[t("strong",[v._v("2xx状态码")])]),v._v(" "),t("p",[v._v("200状态码表示操作成功，但是不同的方法可以返回更精确的状态码。")]),v._v(" "),t("blockquote",[t("p",[v._v("200~299段 表示操作成功：")]),v._v(" "),t("p",[v._v("200 操作成功，正常返回")]),v._v(" "),t("p",[v._v("201 操作成功，已经正在处理该请求")]),v._v(" "),t("p",[v._v("200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。")]),v._v(" "),t("p",[v._v("201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。")]),v._v(" "),t("p",[v._v("202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）")]),v._v(" "),t("p",[v._v("204 NO CONTENT - [DELETE]：用户删除数据成功。")])]),v._v(" "),t("blockquote",[t("p",[v._v("GET：200 OK")]),v._v(" "),t("p",[v._v("POST：201 Created")]),v._v(" "),t("p",[v._v("PUT：200 OK")]),v._v(" "),t("p",[v._v("PATCH：200 OK")]),v._v(" "),t("p",[v._v("DELETE：204 No Content")])]),v._v(" "),t("p",[v._v("上面代码中，POST返回201状态码，表示生成了新的资源；DELETE返回204状态码，表示资源已经不存在。此外，202 Accepted状态码表示服务器已经收到请求，但还未进行处理，会在未来再处理，通常用于异步操作，下面是一个例子。")]),v._v(" "),t("p",[t("strong",[v._v("3xx状态码")])]),v._v(" "),t("p",[v._v("API用不到301状态码（永久重定向）和 302状态码（暂时重定向，307也是这个含义），因为他们可以由应用级别返回，浏览器会直接跳转，API级别可以不考虑这两种情况。")]),v._v(" "),t("blockquote",[t("p",[v._v("300~399段 表示参数方面的异常")]),v._v(" "),t("p",[v._v("300 参数类型错误")]),v._v(" "),t("p",[v._v("301 参数格式错误")]),v._v(" "),t("p",[v._v("302 参数超出正常取值范围")]),v._v(" "),t("p",[v._v("303 token过期")]),v._v(" "),t("p",[v._v("304 token无效")]),v._v(" "),t("p",[v._v("301：永久重定向\n302：暂时重定向")])]),v._v(" "),t("p",[v._v("API用到 3xx 状态码，主要是 303  SeeOther，表示参考另一个URL。他与302和307的含义一样，也是“暂时重定向”，区别在于302和307用于 GET请求，而303 用于 POST、PUT和DELETE请求。收到303以后，浏览器不会自动跳转，而会让用户自己决定下一步怎么办。下面是一个例子。")]),v._v(" "),t("p",[t("strong",[v._v("4xx 状态码")])]),v._v(" "),t("p",[v._v("4xx状态码表示客户端错误，主要有下面几种。")]),v._v(" "),t("blockquote",[t("p",[v._v("400~499段 表示请求地址方面的异常：")]),v._v(" "),t("p",[v._v("400 找不到地址")]),v._v(" "),t("p",[v._v("400 Bad Request：服务器不理解客户端的请求，未做任何处理。")]),v._v(" "),t("p",[v._v("401 Unauthorized：用户未提供身份验证凭据，或者没有通过身份验证。")]),v._v(" "),t("p",[v._v("403 Forbidden：用户通过了身份验证，但是不具有访问资源所需的权限。")]),v._v(" "),t("p",[v._v("404 Not Found：所请求的资源不存在，或不可用。")]),v._v(" "),t("p",[v._v("405 Method Not Allowed：用户已经通过身份验证，但是所有的HTTP方法不在他的权限之内。")]),v._v(" "),t("p",[v._v("410 Gone：所请求的资源已从这个地址转移，不在可用。")]),v._v(" "),t("p",[v._v("415 Unsupported Media Type：客户端要求的返回格式不支持。比如，API只能返回JSON格式，但是客户端要求返回XML格式。")]),v._v(" "),t("p",[v._v("422 Unprocessable Entity：客户端上传的附件无法处理，导致请求失败。")]),v._v(" "),t("p",[v._v("429 Too Many Requests：客户端的请求次数超过限额。")])]),v._v(" "),t("blockquote",[t("p",[v._v("400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。\n401 Unauthorized - ["),t("em",[v._v("]：表示用户没有权限（令牌、用户名、密码错误）。\n403 Forbidden - [")]),v._v("] 表示用户得到授权（与401错误相对），但是访问是被禁止的。\n404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。")]),v._v(" "),t("p",[v._v("406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。")]),v._v(" "),t("p",[v._v("410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。\n422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。")])]),v._v(" "),t("p",[t("strong",[v._v("5xx状态码")])]),v._v(" "),t("p",[v._v("5xx状态码表示服务端错误。一般来说，API不会向用户透漏服务器的详细信息，所以只要两个状态就够了。")]),v._v(" "),t("blockquote",[t("p",[v._v("500~599段 表示内部代码异常：")]),v._v(" "),t("p",[v._v("500 服务器代码异常")]),v._v(" "),t("p",[v._v("500 Internal Server Error：客户端请求有效，服务器处理时发生意外。")]),v._v(" "),t("p",[v._v("503 Service Unavaliable：服务器无法处理请求，一般用于网站维护状态。")])]),v._v(" "),t("p",[v._v("服务器向用户返回的状态码和提示信息，常见的有以下一些（方括号中是该状态码对应的HTTP动词）。")]),v._v(" "),t("blockquote",[t("p",[v._v("§200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。")]),v._v(" "),t("p",[v._v("§201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。")]),v._v(" "),t("p",[v._v("§202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）")]),v._v(" "),t("p",[v._v("§204 NO CONTENT - [DELETE]：用户删除数据成功。")]),v._v(" "),t("p",[v._v("§400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。")]),v._v(" "),t("p",[v._v("§401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。")]),v._v(" "),t("p",[v._v("§403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。")]),v._v(" "),t("p",[v._v("§404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。")]),v._v(" "),t("p",[v._v("§406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。")]),v._v(" "),t("p",[v._v("§410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。")]),v._v(" "),t("p",[v._v("§422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。")]),v._v(" "),t("p",[v._v("§500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。")])]),v._v(" "),t("h3",{attrs:{id:"错误处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误处理"}},[v._v("#")]),v._v(" 错误处理")]),v._v(" "),t("p",[v._v("状态码是4xx时，应返回错误信息，error当做key。")]),v._v(" "),t("p",[v._v("如果状态码是4xx，就应该向用户返回出错信息。一般来说，返回的信息中将error作为键名，出错信息作为键值即可。")]),v._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[v._v('   {\n       error: "Invalid API key"\n   }\n')])]),v._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[v._v("1")]),t("br"),t("span",{staticClass:"line-number"},[v._v("2")]),t("br"),t("span",{staticClass:"line-number"},[v._v("3")]),t("br")])]),t("h3",{attrs:{id:"返回结果格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#返回结果格式"}},[v._v("#")]),v._v(" 返回结果格式")]),v._v(" "),t("p",[v._v("尽量采用json格式避免XML格式。")]),v._v(" "),t("p",[v._v("API返回的数据格式，不应该是纯文本，而应该是一个JSON对象，因为这样才能返回标准的结构化数据。所以，服务器回应的HTTP头的 Content-Type 属性要设为application/json。客户端请求时，也要明确告诉服务器，可以接受JSON格式，即请求的HTTP头的 Accept 属性也要设为 application/json。")]),v._v(" "),t("div",{staticClass:"language-clike line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-clike"}},[t("code",[v._v("   GET "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("collection：返回资源对象的列表（数组）\n   GET "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("collection"),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("resource：返回单个资源对象\n   POST "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("collection：返回新生成的资源对象\n   PUT "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("collection"),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("resource：返回完整的资源对象\n   PATCH "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("collection"),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("resource：返回完整的资源对象\n   DELETE "),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("collection"),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("resource：返回一个空文档\n")])]),v._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[v._v("1")]),t("br"),t("span",{staticClass:"line-number"},[v._v("2")]),t("br"),t("span",{staticClass:"line-number"},[v._v("3")]),t("br"),t("span",{staticClass:"line-number"},[v._v("4")]),t("br"),t("span",{staticClass:"line-number"},[v._v("5")]),t("br"),t("span",{staticClass:"line-number"},[v._v("6")]),t("br")])]),t("h3",{attrs:{id:"版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本"}},[v._v("#")]),v._v(" 版本")]),v._v(" "),t("p",[v._v("应该将API的版本号放入URL。将版本号放进api的url中会比放在请求头header中更为合适，如：http://api.kaky.cn/v2/")]),v._v(" "),t("blockquote",[t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[v._v("https"),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("api"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),v._v("example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),v._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("v1"),t("span",{pre:!0,attrs:{class:"token operator"}},[v._v("/")]),v._v("\n")])]),v._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[v._v("1")]),t("br")])])]),v._v(" "),t("p",[v._v("URL只指定资源，以HTTP方法动词进行不同的操作。用HTTP STATUS/CODE定义操作结果。")]),v._v(" "),t("p",[v._v("Restful：遵守了rest风格的web服务便可称为Restful。")]),v._v(" "),t("h3",{attrs:{id:"过滤信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#过滤信息"}},[v._v("#")]),v._v(" 过滤信息")]),v._v(" "),t("p",[v._v("如果记录数量很多，服务器不可能都将它们返回给用户。API应该提供参数，过滤返回结果。")]),v._v(" "),t("p",[v._v("下面是一些常见的参数。")]),v._v(" "),t("blockquote",[t("p",[v._v("https://api.example.com/v1/zoos?limit=10：指定返回记录的数量")]),v._v(" "),t("p",[v._v("https://api.example.com/v1/zoos?offset=10：指定返回记录的开始位置")]),v._v(" "),t("p",[v._v("https://api.example.com/v1/zoos?page=2&per_page=100：指定第几页，以及每页的记录数")]),v._v(" "),t("p",[v._v("https://api.example.com/v1/zoos?sortby=name&order=asc：指定返回结果按照哪个属性排序，以及排序顺序")]),v._v(" "),t("p",[v._v("https://api.example.com/v1/zoos?animal_type_id=1：指定筛选条件")])]),v._v(" "),t("p",[v._v("参数的设计允许存在冗余，即允许API路径和URL参数偶尔有重复。比如，GET /zoo/ID/animals 与 GET /animals?zoo_id=ID 的含义是相同的。")]),v._v(" "),t("h3",{attrs:{id:"uri规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uri规范"}},[v._v("#")]),v._v(" URI规范")]),v._v(" "),t("blockquote",[t("p",[v._v("1.不用大写；")]),v._v(" "),t("p",[v._v("2.用中杠 - 不用下杠 _ ；")]),v._v(" "),t("p",[v._v("3.参数列表要encode；")]),v._v(" "),t("p",[v._v("4.URI中的名词表示资源集合，使用复数形式。")]),v._v(" "),t("p",[v._v("5.在RESTful架构中，每个网址代表一种资源（resource），所以网址中不能有动词，只能有名词（特殊情况可以使用动词），而且所用的名词往往与数据库的表格名对应。")]),v._v(" "),t("p",[v._v("6.不要在URI中使用尾部正斜杠（/）")]),v._v(" "),t("p",[v._v("7.URI的路径部分使用正斜杠（/）字符表示资源之间的层次关系。")])]),v._v(" "),t("h3",{attrs:{id:"资源集合-vs单个资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源集合-vs单个资源"}},[v._v("#")]),v._v(" 资源集合 vs单个资源")]),v._v(" "),t("p",[v._v("URI表示资源的两种方式：资源集合、单个资源。")]),v._v(" "),t("p",[v._v("资源集合：")]),v._v(" "),t("blockquote",[t("p",[v._v("/zoos //所有动物园")]),v._v(" "),t("p",[v._v("/zoos/1/animals //id为1的动物园中的所有动物")])]),v._v(" "),t("p",[v._v("单个资源：")]),v._v(" "),t("blockquote",[t("p",[v._v("/zoos/1//id为1的动物园")]),v._v(" "),t("p",[v._v("/zoos/1;2;3//id为1，2，3的动物园")])]),v._v(" "),t("p",[v._v("避免层级过深的URI")]),v._v(" "),t("p",[v._v("在url中表达层级，用于 按实体关联关系进行对象导航 ，一般根据id导航。")]),v._v(" "),t("p",[v._v("过深的导航容易导致url膨胀，不易维护，如 GET /zoos/1/areas/3/animals/4 ，尽量使用查询参数代替路径中的实体导航，如 GET/animals?zoo=1&area=3 ；")]),v._v(" "),t("h3",{attrs:{id:"安全性和幂等性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全性和幂等性"}},[v._v("#")]),v._v(" 安全性和幂等性")]),v._v(" "),t("ol",[t("li",[v._v("安全性 ：不会改变资源状态，可以理解为只读的；")]),v._v(" "),t("li",[v._v("幂等性 ：执行1次和执行N次，对资源状态改变的效果是等价的。")])]),v._v(" "),t("table",[t("thead",[t("tr",[t("th"),v._v(" "),t("th",[v._v("安全性")]),v._v(" "),t("th",[v._v("幂等性")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("GET")]),v._v(" "),t("td",[v._v("✔")]),v._v(" "),t("td",[v._v("✔")])]),v._v(" "),t("tr",[t("td",[v._v("POST")]),v._v(" "),t("td",[v._v("✘")]),v._v(" "),t("td",[v._v("✘")])]),v._v(" "),t("tr",[t("td",[v._v("PUT")]),v._v(" "),t("td",[v._v("✘")]),v._v(" "),t("td",[v._v("✔")])]),v._v(" "),t("tr",[t("td",[v._v("DELETE")]),v._v(" "),t("td",[v._v("✘")]),v._v(" "),t("td",[v._v("✔")])])])]),v._v(" "),t("p",[v._v("安全性和幂等性均不保证反复请求能拿到相同的response。以 DELETE为例，第一次DELETE返回200表示删除成功，第二次返回404提示资源不存在，这是允许的。")]),v._v(" "),t("h2",{attrs:{id:"错误分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误分类"}},[v._v("#")]),v._v(" 错误分类")]),v._v(" "),t("h3",{attrs:{id:"http-状态码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-状态码"}},[v._v("#")]),v._v(" "),t("strong",[v._v("Http 状态码")])]),v._v(" "),t("p",[v._v("Http 状态码定义了非常多的错误类型，但实际应用中，我们常用的状态码并不多，通常都是下面这几方面：")]),v._v(" "),t("p",[v._v("API 正常工作 (200, 201)")]),v._v(" "),t("p",[v._v("客户端错误 (400, 401, 403, 404)")]),v._v(" "),t("p",[v._v("服务端错误 (500, 503)")]),v._v(" "),t("h3",{attrs:{id:"业务错误码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#业务错误码"}},[v._v("#")]),v._v(" "),t("strong",[v._v("业务错误码")])]),v._v(" "),t("p",[v._v("很多时候，我们根据业务类型来自定义错误码。")]),v._v(" "),t("p",[v._v("这些业务错误码与 Http 状态码并不重叠，这时候我们可以返回业务错误码，用来提示用户/开发者错误类型。")]),v._v(" "),t("h3",{attrs:{id:"给用户看的错误信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#给用户看的错误信息"}},[v._v("#")]),v._v(" 给用户看的错误信息")]),v._v(" "),t("p",[v._v("当出现错误的时候，我们需要提示用户如何处理这种情况，通常这种错误信息都是必须的。")]),v._v(" "),t("h3",{attrs:{id:"给开发者看的错误信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#给开发者看的错误信息"}},[v._v("#")]),v._v(" 给开发者看的错误信息")]),v._v(" "),t("p",[v._v("若我们的 API 需要开放给第三方开发者，那么我们就需要考虑返回一些给开发者看的错误信息。")]),v._v(" "),t("h3",{attrs:{id:"设计错误类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设计错误类型"}},[v._v("#")]),v._v(" "),t("strong",[v._v("设计错误类型")])]),v._v(" "),t("p",[v._v("我们刚才提到过，可以利用 Http 状态码来为错误类型进行分类。")]),v._v(" "),t("p",[v._v("通常我们所说的分类通常是对客户端错误进行分类， 即 4xx 类型的错误。")]),v._v(" "),t("p",[v._v("而这些错误类型中，我们最常用的是：")]),v._v(" "),t("blockquote",[t("p",[v._v("400 Bad Request")]),v._v(" "),t("p",[v._v("由于包含语法错误，当前请求无法被服务器理解。除非进行修改，否则客户端不应该重复提交这个请求。")]),v._v(" "),t("p",[v._v("通常在请求参数不合法或格式错误的时候可以返回这个状态码。")]),v._v(" "),t("p",[v._v("401 Unauthorized")]),v._v(" "),t("p",[v._v("当前请求需要用户验证。")]),v._v(" "),t("p",[v._v("通常在没有登录的状态下访问一些受保护的 API 时会用到这个状态码。")]),v._v(" "),t("p",[v._v("403 Forbidden")]),v._v(" "),t("p",[v._v("服务器已经理解请求，但是拒绝执行它。与401响应不同的是，身份验证并不能提供任何帮助。")]),v._v(" "),t("p",[v._v("通常在没有权限操作资源时(如修改/删除一个不属于该用户的资源时)会用到这个状态码。")]),v._v(" "),t("p",[v._v("404 Not Found")]),v._v(" "),t("p",[v._v("请求失败，请求所希望得到的资源未被在服务器上发现。")]),v._v(" "),t("p",[v._v("通常在找不到资源时返回这个状态码。")])]),v._v(" "),t("p",[v._v("格式错误 (FORMAT_INVALID)")]),v._v(" "),t("p",[v._v("数据不存在 (DATA_NOT_FOUND)")]),v._v(" "),t("p",[v._v("数据已存在 (DATA_EXISTED)")]),v._v(" "),t("p",[v._v("数据无效 (DATA_INVALID)")]),v._v(" "),t("p",[v._v("登录错误 (LOGIN_REQUIRED)")]),v._v(" "),t("p",[v._v("权限不足 (PERMISSION_DENIED)")])])}),[],!1,null,null,null);_.default=a.exports}}]);
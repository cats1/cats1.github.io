<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Model | lana&#39;s home</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="vuepress 前端个人学习网站">
    
    <link rel="preload" href="/assets/css/0.styles.98530cad.css" as="style"><link rel="preload" href="/assets/js/app.a4743452.js" as="script"><link rel="preload" href="/assets/js/2.b72805e3.js" as="script"><link rel="preload" href="/assets/js/31.eac619f5.js" as="script"><link rel="prefetch" href="/assets/js/10.97c6631e.js"><link rel="prefetch" href="/assets/js/100.ddd238ad.js"><link rel="prefetch" href="/assets/js/101.acf46de3.js"><link rel="prefetch" href="/assets/js/102.7ecc34c5.js"><link rel="prefetch" href="/assets/js/103.9abec0c7.js"><link rel="prefetch" href="/assets/js/104.99a0bd64.js"><link rel="prefetch" href="/assets/js/105.5bd4279e.js"><link rel="prefetch" href="/assets/js/106.4a1a1e6d.js"><link rel="prefetch" href="/assets/js/107.53190e25.js"><link rel="prefetch" href="/assets/js/108.afb416d9.js"><link rel="prefetch" href="/assets/js/109.9c89f8cf.js"><link rel="prefetch" href="/assets/js/11.efe147a8.js"><link rel="prefetch" href="/assets/js/110.77f01a7c.js"><link rel="prefetch" href="/assets/js/111.f8ccec3a.js"><link rel="prefetch" href="/assets/js/112.a1b70a36.js"><link rel="prefetch" href="/assets/js/113.f74d3176.js"><link rel="prefetch" href="/assets/js/114.9f4f70ac.js"><link rel="prefetch" href="/assets/js/115.3e915f82.js"><link rel="prefetch" href="/assets/js/116.21d4d9f8.js"><link rel="prefetch" href="/assets/js/117.ed1ac975.js"><link rel="prefetch" href="/assets/js/118.b60ec45f.js"><link rel="prefetch" href="/assets/js/119.a28f9722.js"><link rel="prefetch" href="/assets/js/12.f8166b62.js"><link rel="prefetch" href="/assets/js/120.5f45ba33.js"><link rel="prefetch" href="/assets/js/121.e2c73c6e.js"><link rel="prefetch" href="/assets/js/122.bea0d35f.js"><link rel="prefetch" href="/assets/js/123.4918a056.js"><link rel="prefetch" href="/assets/js/124.e9d5fd6b.js"><link rel="prefetch" href="/assets/js/125.378cd9ad.js"><link rel="prefetch" href="/assets/js/126.785be7e4.js"><link rel="prefetch" href="/assets/js/127.2dfe1120.js"><link rel="prefetch" href="/assets/js/128.0eeadbcb.js"><link rel="prefetch" href="/assets/js/129.ffd3ffd2.js"><link rel="prefetch" href="/assets/js/13.669aa6cb.js"><link rel="prefetch" href="/assets/js/130.e3caaa90.js"><link rel="prefetch" href="/assets/js/131.8914dd22.js"><link rel="prefetch" href="/assets/js/132.0ae37932.js"><link rel="prefetch" href="/assets/js/133.e989899b.js"><link rel="prefetch" href="/assets/js/134.ea062f20.js"><link rel="prefetch" href="/assets/js/135.6c137b49.js"><link rel="prefetch" href="/assets/js/14.c9aa70a1.js"><link rel="prefetch" href="/assets/js/15.3d05e5f2.js"><link rel="prefetch" href="/assets/js/16.360281d8.js"><link rel="prefetch" href="/assets/js/17.ff7cabb3.js"><link rel="prefetch" href="/assets/js/18.be16eeed.js"><link rel="prefetch" href="/assets/js/19.81b3a31e.js"><link rel="prefetch" href="/assets/js/20.472bc449.js"><link rel="prefetch" href="/assets/js/21.86395f2b.js"><link rel="prefetch" href="/assets/js/22.6c69ed50.js"><link rel="prefetch" href="/assets/js/23.2f198631.js"><link rel="prefetch" href="/assets/js/24.748c9bc2.js"><link rel="prefetch" href="/assets/js/25.c5065323.js"><link rel="prefetch" href="/assets/js/26.61d441a1.js"><link rel="prefetch" href="/assets/js/27.bfd0a986.js"><link rel="prefetch" href="/assets/js/28.bafeb054.js"><link rel="prefetch" href="/assets/js/29.0d2a1bfd.js"><link rel="prefetch" href="/assets/js/3.7f8809fd.js"><link rel="prefetch" href="/assets/js/30.8bb40757.js"><link rel="prefetch" href="/assets/js/32.04c63c5c.js"><link rel="prefetch" href="/assets/js/33.ae09c55e.js"><link rel="prefetch" href="/assets/js/34.1145a6f4.js"><link rel="prefetch" href="/assets/js/35.feb9083f.js"><link rel="prefetch" href="/assets/js/36.a586ce8a.js"><link rel="prefetch" href="/assets/js/37.c61e20e9.js"><link rel="prefetch" href="/assets/js/38.991c3427.js"><link rel="prefetch" href="/assets/js/39.23356a49.js"><link rel="prefetch" href="/assets/js/4.6819ae80.js"><link rel="prefetch" href="/assets/js/40.a3ca9111.js"><link rel="prefetch" href="/assets/js/41.649b9d9b.js"><link rel="prefetch" href="/assets/js/42.fde8ad7b.js"><link rel="prefetch" href="/assets/js/43.2d876a7c.js"><link rel="prefetch" href="/assets/js/44.64c20de7.js"><link rel="prefetch" href="/assets/js/45.a901a632.js"><link rel="prefetch" href="/assets/js/46.4ac83b64.js"><link rel="prefetch" href="/assets/js/47.2b45c49a.js"><link rel="prefetch" href="/assets/js/48.2bc12623.js"><link rel="prefetch" href="/assets/js/49.52a95dcd.js"><link rel="prefetch" href="/assets/js/5.20de2bc4.js"><link rel="prefetch" href="/assets/js/50.f445c922.js"><link rel="prefetch" href="/assets/js/51.07570e18.js"><link rel="prefetch" href="/assets/js/52.cf21a2b8.js"><link rel="prefetch" href="/assets/js/53.77792ddd.js"><link rel="prefetch" href="/assets/js/54.f19c487a.js"><link rel="prefetch" href="/assets/js/55.7fb0d05b.js"><link rel="prefetch" href="/assets/js/56.62fd0b66.js"><link rel="prefetch" href="/assets/js/57.1d6b0809.js"><link rel="prefetch" href="/assets/js/58.1aed920b.js"><link rel="prefetch" href="/assets/js/59.c2ab9dbe.js"><link rel="prefetch" href="/assets/js/6.e9784f3e.js"><link rel="prefetch" href="/assets/js/60.f4e387a9.js"><link rel="prefetch" href="/assets/js/61.735cc066.js"><link rel="prefetch" href="/assets/js/62.312489f2.js"><link rel="prefetch" href="/assets/js/63.dd2a2d4e.js"><link rel="prefetch" href="/assets/js/64.67dfd073.js"><link rel="prefetch" href="/assets/js/65.c2c22de8.js"><link rel="prefetch" href="/assets/js/66.7ea30a4b.js"><link rel="prefetch" href="/assets/js/67.6913be8c.js"><link rel="prefetch" href="/assets/js/68.b743701c.js"><link rel="prefetch" href="/assets/js/69.088259eb.js"><link rel="prefetch" href="/assets/js/7.80ddef84.js"><link rel="prefetch" href="/assets/js/70.10e2101b.js"><link rel="prefetch" href="/assets/js/71.11121db3.js"><link rel="prefetch" href="/assets/js/72.38811b9b.js"><link rel="prefetch" href="/assets/js/73.b5030976.js"><link rel="prefetch" href="/assets/js/74.d218c8d5.js"><link rel="prefetch" href="/assets/js/75.89c8d415.js"><link rel="prefetch" href="/assets/js/76.998def7e.js"><link rel="prefetch" href="/assets/js/77.6cff4b72.js"><link rel="prefetch" href="/assets/js/78.45b13ba4.js"><link rel="prefetch" href="/assets/js/79.50d5b3d0.js"><link rel="prefetch" href="/assets/js/8.4ebeab97.js"><link rel="prefetch" href="/assets/js/80.e38925eb.js"><link rel="prefetch" href="/assets/js/81.c712e794.js"><link rel="prefetch" href="/assets/js/82.f4018c72.js"><link rel="prefetch" href="/assets/js/83.878fb392.js"><link rel="prefetch" href="/assets/js/84.7ddaa3ca.js"><link rel="prefetch" href="/assets/js/85.06c8fa8b.js"><link rel="prefetch" href="/assets/js/86.b889a2e3.js"><link rel="prefetch" href="/assets/js/87.2f3171f1.js"><link rel="prefetch" href="/assets/js/88.1b0c6839.js"><link rel="prefetch" href="/assets/js/89.293034a1.js"><link rel="prefetch" href="/assets/js/9.07e73bd0.js"><link rel="prefetch" href="/assets/js/90.cdd9df6a.js"><link rel="prefetch" href="/assets/js/91.e53063a5.js"><link rel="prefetch" href="/assets/js/92.0a41da3b.js"><link rel="prefetch" href="/assets/js/93.83c37c7e.js"><link rel="prefetch" href="/assets/js/94.14eea0cb.js"><link rel="prefetch" href="/assets/js/95.18279896.js"><link rel="prefetch" href="/assets/js/96.e06d8e4e.js"><link rel="prefetch" href="/assets/js/97.2b60994e.js"><link rel="prefetch" href="/assets/js/98.28ad17a5.js"><link rel="prefetch" href="/assets/js/99.2abf3996.js">
    <link rel="stylesheet" href="/assets/css/0.styles.98530cad.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="lana's home" class="logo"> <span class="site-name can-hide">lana's home</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><span class="title">随笔</span> <span class="arrow down"></span></button> <button type="button" aria-label="随笔" class="mobile-dropdown-title"><span class="title">随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/html5/" class="nav-link">
  Html5
</a></li><li class="dropdown-subitem"><a href="/front/css/" class="nav-link">
  Css
</a></li><li class="dropdown-subitem"><a href="/front/js/" class="nav-link">
  js
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-subitem"><a href="/backend/koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-subitem"><a href="/backend/mongodb/" class="nav-link router-link-active">
  Mongodb
</a></li></ul></li><li class="dropdown-item"><h4>
          服务器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/nginx/" class="nav-link">
  Nginx
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/guide/guide.html" class="nav-link">
  指引
</a></div><div class="nav-item"><a href="https://gitee.com/lanasine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/cats1/vuepresshome" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><span class="title">随笔</span> <span class="arrow down"></span></button> <button type="button" aria-label="随笔" class="mobile-dropdown-title"><span class="title">随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/html5/" class="nav-link">
  Html5
</a></li><li class="dropdown-subitem"><a href="/front/css/" class="nav-link">
  Css
</a></li><li class="dropdown-subitem"><a href="/front/js/" class="nav-link">
  js
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-subitem"><a href="/backend/koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-subitem"><a href="/backend/mongodb/" class="nav-link router-link-active">
  Mongodb
</a></li></ul></li><li class="dropdown-item"><h4>
          服务器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/nginx/" class="nav-link">
  Nginx
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/guide/guide.html" class="nav-link">
  指引
</a></div><div class="nav-item"><a href="https://gitee.com/lanasine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/cats1/vuepresshome" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Backend</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Api</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Koa</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Mongodb</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/backend/mongodb/" aria-current="page" class="sidebar-link">mongodb</a></li><li><a href="/backend/mongodb/middleware.html" class="sidebar-link">中间件</a></li><li><a href="/backend/mongodb/model.html" aria-current="page" class="active sidebar-link">Model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/mongodb/model.html#常用数据库操作" class="sidebar-link">常用数据库操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/mongodb/model.html#新增" class="sidebar-link">新增</a></li><li class="sidebar-sub-header"><a href="/backend/mongodb/model.html#删除" class="sidebar-link">删除</a></li><li class="sidebar-sub-header"><a href="/backend/mongodb/model.html#修改" class="sidebar-link">修改</a></li><li class="sidebar-sub-header"><a href="/backend/mongodb/model.html#查询" class="sidebar-link">查询</a></li></ul></li></ul></li><li><a href="/backend/mongodb/mongoose.html" class="sidebar-link">mongoose</a></li><li><a href="/backend/mongodb/schma.html" class="sidebar-link">Schema（模式）</a></li><li><a href="/backend/mongodb/ru-men.html" class="sidebar-link">MongoDB：入门</a></li><li><a href="/backend/mongodb/qi-dong.html" class="sidebar-link">启动</a></li><li><a href="/backend/mongodb/shu-ju-ku-guan-li.html" class="sidebar-link">MongoDB：数据库管理</a></li><li><a href="/backend/mongodb/wen-dang-zeng-shan-gai-cha.html" class="sidebar-link">文档增删改查</a></li><li><a href="/backend/mongodb/yong-hu-quan-xian.html" class="sidebar-link">用户权限</a></li><li><a href="/backend/mongodb/lian-jie-shi-bai.html" class="sidebar-link">connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb Error: coul</a></li><li><a href="/backend/mongodb/ji-he-guan-li.html" class="sidebar-link">MongoDB：集合管理</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Front</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guide</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="model"><a href="#model" class="header-anchor">#</a> Model</h1> <p><strong>model是由schema生成的模型，可以对数据库的操作</strong></p> <p>由Schema发布生成的模型，具有抽象属性。可以对数据库的操作。<strong>model第一个参数如果不带s，影射到数据库里的collection名称会带上s</strong></p> <h2 id="常用数据库操作"><a href="#常用数据库操作" class="header-anchor">#</a> 常用数据库操作</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//设定规则</span>
<span class="token keyword">const</span> userSchema<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token punctuation">{</span>
       type<span class="token operator">:</span>String<span class="token punctuation">,</span>
       required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">//必填项</span>
       minlength<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>     <span class="token comment">//最小长度</span>
       maxlength<span class="token operator">:</span> <span class="token number">20</span>     <span class="token comment">//最大长度</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span>String，
    age<span class="token operator">:</span>Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//创建集合</span>
<span class="token keyword">const</span> User<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="新增"><a href="#新增" class="header-anchor">#</a> 新增</h3> <h4 id="save"><a href="#save" class="header-anchor">#</a> save()</h4> <p>是模型的实例方法。有更新和插入两种功能。</p> <blockquote><p>[save(<a href="#model_Model-save">options], [options.safe], [options.validateBeforeSave], [fn])</a>有更新和插入两种功能，到底是插入还是更新文档取决于save的参数。决定是插入一个文档还是更新，取决于_id参数。如果能根据_id找到一个已经存在的文档，那么就更新。如果没有传入_id参数或者找不到存在的文档，那么就插入一个新文档。带_id参数，但是找不到一个已经存在的文档，还是插入一个新文档，但是_id不会自动生成。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//创建实例</span>
<span class="token keyword">const</span> user<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   name：<span class="token string">&quot;le&quot;</span><span class="token punctuation">,</span>
   password<span class="token operator">:</span><span class="token string">&quot;2131132&quot;</span><span class="token punctuation">,</span>
   age<span class="token operator">:</span><span class="token number">13</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//保存</span>
user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="create"><a href="#create" class="header-anchor">#</a> create()</h4> <p>是直接从模型中调用的作为方法调用，本质上是静态的，并将对象作为第一个参数。</p> <blockquote><p>[Model.create(doc(s), <a href="#model_Model.create">callback])</a></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   name<span class="token operator">:</span><span class="token string">&quot;le&quot;</span><span class="token punctuation">,</span>
   password<span class="token operator">:</span><span class="token string">&quot;2131132&quot;</span><span class="token punctuation">,</span>
   age<span class="token operator">:</span><span class="token number">13</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="insertmany"><a href="#insertmany" class="header-anchor">#</a> insertMany()</h4> <p>插入多条</p> <blockquote><p>[Model.insertMany(doc(s), <a href="#model_Model.insertMany">options], [callback])</a>多条数据插入，将多条数据一次性插入，相对于循环使用create保存会更加快。</p></blockquote> <h4 id="save和create的区别"><a href="#save和create的区别" class="header-anchor">#</a> save和create的区别：</h4> <blockquote><p>save数据被插入时被赋予了一个主键值，之后的操作由于主键相同就被方法判定为更新操作，导致每次只能新增一条数据。(只针对当前实例)</p> <p>create每一次执行都生成一个实例对象，每一个对象都会得到一个不同的主键，所有可以插入多条相同数据（保存一组文档）</p></blockquote> <h3 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//删除一个，只删除满足条件的第一个列表项</span>
User<span class="token punctuation">.</span><span class="token function">findOneAndDelete</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token comment">//这里为查询条件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回的是删除的数据</span>
<span class="token comment">//删除多个</span>
User<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token comment">//这里为查询条件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回的是删除的数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="findoneanddelete"><a href="#findoneanddelete" class="header-anchor">#</a> findOneAndDelete()</h4> <p>查找匹配的一个文档，将其删除</p> <blockquote><p>findOneAndDelete(conditions,[update],[options],[options.lean],[callback])</p> <p>options有以下选项：
　　sort： 如果查询条件找到多个文档，则设置排序顺序以选择要删除哪个文档。
　　select/projection：指定返回的字段。
　　rawResult：如果为 true，则返回来自 MongoDB 的原生结果。</p></blockquote> <h4 id="findoneandremove"><a href="#findoneandremove" class="header-anchor">#</a> findOneAndRemove()</h4> <p>查找匹配的一个文档，将其删除。用法与 <code>findOneAndDelete()</code> 一样，一个小小的区别是 <code>findOneAndRemove()</code> 会调用 MongoDB 原生的 <code>findAndModify()</code> 命令，而不是 <code>findOneAndDelete()</code> 命令。建议使用 <code>findOneAndDelete()</code> 方法。</p> <blockquote><p>findOneAndDelete(conditions,[options],[callback])</p></blockquote> <h4 id="remove"><a href="#remove" class="header-anchor">#</a> <s>remove()</s></h4> <p>从集合中删除文档（已弃用）。从集合中删除所有匹配 <code>filter</code> 条件的文档。</p> <blockquote><p>Model.remove(conditions, [callback])</p></blockquote> <h4 id="findbyidandremove"><a href="#findbyidandremove" class="header-anchor">#</a> findByIdAndRemove()</h4> <p>查找匹配的文档，将其删除，并将找到的文档（如果有）传递给回调。</p> <blockquote><p>Model.findByIdAndRemove(id, [options], [callback])</p> <p>options有以下选项：
　　sort： 如果有多个查询条件，按顺序进行查询更新。
　　select： 设置数据的返回。</p></blockquote> <h4 id="deleteone"><a href="#deleteone" class="header-anchor">#</a> deleteOne()</h4> <p>从集合中删除第一个符合条件的文档。其行为类似于remove（），但不管使用哪个选项，最多只删除一个文档。</p> <blockquote><p>Model.deleteOne(conditions,[options] ,[callback])</p></blockquote> <h4 id="deletemany"><a href="#deletemany" class="header-anchor">#</a> deleteMany()</h4> <p>从集合中删除符合条件的所有文档，类似remove</p> <blockquote><p>Model.deleteMany(conditions,[options], [callback])</p></blockquote> <h3 id="修改"><a href="#修改" class="header-anchor">#</a> 修改</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 更新单个</span>
User<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">/*查询条件*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">/*要修改的值*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 更新多个</span>
User<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">/*查询条件*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">/*要更改的值*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="updateone"><a href="#updateone" class="header-anchor">#</a> updateOne()</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>Model.updateOne(filter, update[, options][, callback])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>与 <code>update()</code> 相同，只是它不支持 <code>multi</code> 和 <code>overwrite</code> 选项参数，<code>update</code> 参数必须使用 <code>update</code> 操作符。</p> <p>只更新第一条符合条件的文档的属性，如果要覆盖文档的全部内容，请使用 <code>replaceOne()</code>。</p> <h4 id="updatemany"><a href="#updatemany" class="header-anchor">#</a> updateMany()</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>Model.updateMany(filter, update[, options][, callback])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>更新符合查询条件的所有文档，相当于 <code>Model.update(filter, update, { multi: true }[, callback])</code></p> <h4 id="findbyidandupdate"><a href="#findbyidandupdate" class="header-anchor">#</a> findByIdAndUpdate()</h4> <p>找到匹配的文档，根据update变量更新它，传递任何选项，并将找到的文档（如果有）返回到回调。如果回调被传递，则查询立即执行，否则返回一个Query对象。</p> <blockquote><p>Model.findByIdAndUpdate(id, [update], [options], [callback])</p> <p>Options:</p> <p>new : true 返回修改的文档而不是原始文档。默认为true</p> <p>upsert：false 如果对象不存在，则创建对象。默认为false</p> <p>runValidators： 如果值为true，执行Validation验证。
setDefaultsOnInsert： 如果upsert选项为true，在新建时插入文档定义的默认值。</p> <p>Sort: 如果按照条件找到多个文档，请设置排序顺序以选择要更新的文档
select: 设置要返回的文档字段</p></blockquote> <h4 id="findoneandupdate"><a href="#findoneandupdate" class="header-anchor">#</a> findOneAndUpdate()</h4> <p>默认返回原始的数据</p> <blockquote><p>Model.findOneAndUpdate(conditions, [update], [options], [callback])</p> <p>options有以下选项：
　　new： bool - 默认为false。返回修改后的数据。
　　upsert： bool - 默认为false。如果不存在则创建记录。
　　fields： {Object|String} - 选择字段。类似.select(fields).findOneAndUpdate()。
　　maxTimeMS： 查询用时上限。
　　sort： 如果有多个查询条件，按顺序进行查询更新。
　　runValidators： 如果值为true，执行Validation验证。
　　setDefaultsOnInsert： 如果upsert选项为true，在新建时插入文档定义的默认值。
　　passRawResult： 如果为真，将原始结果作为回调函数第三个参数。</p></blockquote> <h4 id="update"><a href="#update" class="header-anchor">#</a> <s>update()</s></h4> <p>更新数据库中的文档而不返回它们。（已弃用）</p> <h4 id="replaceone"><a href="#replaceone" class="header-anchor">#</a> replaceOne()</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>Model.replaceOne(filter, replace[, options][, callback])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置与 <code>update()</code> 相同，只是会用 <code>replace</code> 参数中的数据覆盖符合条件的第一条文档，而不是更新属性，不支持任何 <code>update</code> 操作符。</p> <h3 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//  根据条件查找文档（条件为空则查找所有文档）</span>
 User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">//  根据条件查找文档</span>
 User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'node.js基础'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">//匹配大于 小于</span>
 User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token punctuation">{</span>$gt<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">//匹配包含</span>
 User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'le'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">//选择要查询的字段  </span>
 User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">//将数据按照年龄进行排序</span>
 User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">//skip 跳过多少条数据  limit 限制查询数量</span>
 User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="find"><a href="#find" class="header-anchor">#</a> find()</h4> <p>查询所有符合条件的文档，总会返回一个数组。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Model.find(conditions,fields,[options],[callback])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>conditions查询条件</p> <p>fields需要获取到的字段</p> <p>options查询的选项（例如常用的skip和limit）</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>model.find({}, callback);
model.find({},field,callback); 过滤查询,参数2: {‘name’:1, ‘age’:0} 查询文档的返回结果包含name , 不包含age.(_id默认是1)
参数2field可以是对象也可以是字符串”name age”若是过滤_id,_id属性前面添加一个减号即可去除默认指定。”name age -_id”
model.find({},null,{limit:20}); 过滤查询,参数3: 游标操作 limit限制返回结果数量为20个,如不足20个则返回所有.
参数3查询选项如{
Skip:3,//跳过前面3个
Limit:2//显示文档个数
}
//查询非空字段
Model.find(conditions:{$exists:true})
Model.find(conditions:{$ne:null})
//模糊查询
userModel.find({&quot;name&quot; : {$regex:'大虾'}})
userModel.find({&quot;name&quot; : /大虾/ }})
//分页查询
Model.find(conditions).skip(pageTotal * pageNum).limit(pageTotal).sort({'_id':-1}).exec(cb);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="findone"><a href="#findone" class="header-anchor">#</a> findOne()</h4> <p>查询符合条件的第一个（首个）文档，总会返回一个具体的文档对象</p> <blockquote><p>model.findOne(conditions,field,[options],[callback])</p></blockquote> <h4 id="findbyid"><a href="#findbyid" class="header-anchor">#</a> findById()</h4> <p>根据文档的_id属性查询文档,返回对象</p> <blockquote><p>model.findById(conditions,field,[options],[callback])</p></blockquote> <h4 id="distinct"><a href="#distinct" class="header-anchor">#</a> distinct</h4> <p>查询符合条件的文档并返回根据键分组的结果。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Model.distinct(field, conditions, callback);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="where复杂查询"><a href="#where复杂查询" class="header-anchor">#</a> where复杂查询</h4> <p>当查询比较复杂时，用 where</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Model
<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token comment">//年龄大于25</span>
<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'tags'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'movie'</span><span class="token punctuation">,</span> <span class="token string">'music'</span><span class="token punctuation">,</span> <span class="token string">'art'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//tags查询</span>
<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'tags'</span><span class="token punctuation">)</span><span class="token comment">//输出name、age、tags三个字段</span>
<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">slaveOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">hint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="联合查询populate"><a href="#联合查询populate" class="header-anchor">#</a> 联合查询populate()</h4> <p>两个不同表中的数据有关联，要通过一个表中的数据找到另一个表的数据，需要使用populate方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 用户集合</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 文章集合</span>
<span class="token keyword">const</span> Post <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Post'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 使用ID将文章集合和作者集合进行关联</span>
    author<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> ref<span class="token operator">:</span> <span class="token string">'User'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//联合查询</span>
Post<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="聚合aggregate"><a href="#聚合aggregate" class="header-anchor">#</a> 聚合aggregate()</h4> <p>聚合管道可以对集合中的文档进行变换和组合。实际项目：多表关联查询、数据的统计</p> <p><strong>聚合管道</strong>常用的几个操作</p> <ul><li>$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。对应<code>project()</code>方法</li> <li>$match：用于过滤数据，只输出符合条件的文档。使用 MongoDB 的标准查询操作。对应<code>match()</code>。</li> <li>$limit：用来限制 MongoDB 聚合管道返回的文档数。对应<code>limit()</code>方法</li> <li>$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。对应<code>skip()</code>。</li> <li>$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。对应<code>unwind()</code>方法</li> <li>$group：将集合中的文档分组，可用于统计结果。对应<code>group()</code>方法</li> <li>$sort：将输入文档排序后输出。对应<code>sort()</code>方法</li> <li>$lookup：多表关联。</li> <li>$geoNear：输出接近某一地理位置的有序文档。对应<code>near()</code>。</li></ul> <h5 id="group"><a href="#group" class="header-anchor">#</a> $group</h5> <p>对集合中的文档进行分组，可用于统计结果。</p> <p>$group 里面对应需要聚合操作的列必须写成 <code>_id</code> , 否则会出现 <code>The field 'xxx' must be an accumulator object</code> 的报错信息</p> <p><strong><code>$group</code>表达式说明：</strong></p> <blockquote><p><strong><code>$sum</code></strong> 计算总和</p> <p><strong><code>$avg</code></strong> 计算平均值</p> <p><strong><code>$min</code></strong> 获取每一组集合中所有文档对应值得最小值</p> <p><strong>$max</strong> 获取每一组集合中所有文档对应值得最大值</p> <p><strong>$push</strong> 在结果文档中插入值到一个数组中</p> <p><strong>$addToSet</strong> 在结果文档中插入值到一个数组中，但不创建副本</p> <p><strong>$first</strong> 根据资源文档的排序获取第一个文档数据</p> <p><strong>$last</strong> 根据资源文档的排序获取最后一个文档数据</p></blockquote> <p>例如：按照订单号分组，统计每个订单的购买的商品总量</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>db.order_item.aggregate(
[
     {
          $group: {_id: &quot;$order_id&quot;, total: {$sum: &quot;$number&quot;}}
     }
])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="project"><a href="#project" class="header-anchor">#</a> $project</h5> <p>筛选文档中指定的字段，例如返回username字段1返回0不返回._id如果不指定会默认返回</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>db.getCollection('users').aggregate([{
    $project:{username:1}
    }])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="match"><a href="#match" class="header-anchor">#</a> $match</h5> <p>筛选指定条件过滤满足条件的文档</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>db.getCollection('users').aggregate([{
    $project:{username:1,_id:0}
    },{
        $match:{'username':{$in:['admin1']}}
     }])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="sort"><a href="#sort" class="header-anchor">#</a> $sort</h5> <p>对集合中的文档进行排序。1升序-1降序</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
        $sort:{'age':1}
     }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="limit"><a href="#limit" class="header-anchor">#</a> $limit</h5> <p>获取指定数量的文档</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
	$limit:1
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="skip"><a href="#skip" class="header-anchor">#</a> $skip</h5> <p>跳过指定数量的文档</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
	$skip:1
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="lookup表关联"><a href="#lookup表关联" class="header-anchor">#</a> $lookup表关联</h5> <p>$lookup操作符用以引入其它集合的数据（用作多表关联查询）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>db.order.aggregate([
    {
      $lookup:
        {
          from: &quot;order_item&quot;,
          localField: &quot;order_id&quot;,
          foreignField: &quot;order_id&quot;,
          as: &quot;itemInfo&quot;
        }
   }
])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="获取文档数"><a href="#获取文档数" class="header-anchor">#</a> 获取文档数</h4> <p>返回符合条件的文档数。</p> <h5 id="count"><a href="#count" class="header-anchor">#</a> <s>count()</s></h5> <p>统计与数据库集合中的<code>filter</code>所匹配的文档数。（已弃用）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Model.count(conditions, callback);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="countdocuments"><a href="#countdocuments" class="header-anchor">#</a> countDocuments()</h5> <p>统计与数据库集合中的<code>conditions</code>所匹配的文档数。请注意，如果要统计大型集合中的所有文档，请使用estimatedDocumentCount()，如果使用<code>countDocuments()</code>函数MongoDB将始终执行完整的集合扫描而不使用任何索引。</p> <blockquote><p>countDocuments(conditions, [callback])</p></blockquote> <h5 id="estimateddocumentcount"><a href="#estimateddocumentcount" class="header-anchor">#</a> estimatedDocumentCount()</h5> <p>统计与数据库集合中的conditions所匹配的文档数。</p> <blockquote><p>estimatedDocumentCount(conditions, [callback])</p></blockquote> <h4 id="操作符"><a href="#操作符" class="header-anchor">#</a> 操作符</h4> <h5 id="管道操作符"><a href="#管道操作符" class="header-anchor">#</a> 管道操作符</h5> <table><thead><tr><th>操作符</th> <th>含义</th></tr></thead> <tbody><tr><td>$group</td> <td>将collection中的document分组，可用于统计结果</td></tr> <tr><td>$match</td> <td>过滤数据，只输出符合结果的文档</td></tr> <tr><td>$project</td> <td>修改输入文档的结构(例如重命名，增加、删除字段，创建结算结果等)</td></tr> <tr><td>$sort</td> <td>将结果进行排序后输出</td></tr> <tr><td>$limit</td> <td>限制管道输出的结果个数</td></tr> <tr><td>$skip</td> <td>跳过制定数量的结果，并且返回剩下的结果</td></tr> <tr><td>$unwind</td> <td>将数组类型的字段进行拆分</td></tr></tbody></table> <h5 id="表达式操作符"><a href="#表达式操作符" class="header-anchor">#</a> 表达式操作符</h5> <table><thead><tr><th>操作符</th> <th>含义</th> <th>实例</th></tr></thead> <tbody><tr><td>$sum</td> <td>计算总和，{<code>$sum</code>: 1}表示返回总和×1的值(即总和的数量),使用{<code>$sum</code>: <code>'$制定字段'</code>}也能直接获取制定字段的值的总和</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, content_sum : {$sum : &quot;$likes&quot;}}}])</td></tr> <tr><td>$avg</td> <td>平均值</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, content_sum : {$avg : &quot;$likes&quot;}}}])</td></tr> <tr><td>$min</td> <td>获取集合中所有文档对应值得最小值</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, content_sum : {$min : &quot;$likes&quot;}}}])</td></tr> <tr><td>$max</td> <td>获取集合中所有文档对应值得最大值</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, content_sum : {$max : &quot;$likes&quot;}}}])</td></tr> <tr><td>$push</td> <td>在结果文档中插入值到一个数组中</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$push : &quot;$url&quot;}}}])</td></tr> <tr><td>$addToSet</td> <td>在结果文档中插入值到一个数组中，但不创建副本</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$addToSet : &quot;$url&quot;}}}])</td></tr> <tr><td>$first</td> <td>根据资源文档的排序获取第一个文档数据</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$first : &quot;$url&quot;}}}])</td></tr> <tr><td>$last</td> <td>根据资源文档的排序获取最后一个文档数据</td> <td>db.collection.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$last : &quot;$url&quot;}}}])</td></tr></tbody></table> <h5 id="条件操作符"><a href="#条件操作符" class="header-anchor">#</a> 条件操作符</h5> <table><thead><tr><th>操作符</th> <th>含义</th> <th>type</th> <th>type</th> <th>等价方法</th></tr></thead> <tbody><tr><td>$or</td> <td>或关系</td> <td>数组</td> <td>$name:{$or:['admin','test']}</td> <td>or(['admin','test'])</td></tr> <tr><td>$nor</td> <td>或关系取反</td> <td>数组</td> <td>$name:{$nor:['admin','test']}</td> <td>nor(['admin','test'])</td></tr> <tr><td>$gt</td> <td>大于</td> <td>Number</td> <td>$age:{$gt:2}</td> <td>gt('age', 2)</td></tr> <tr><td>$gte</td> <td>大于等于</td> <td>Number</td> <td>$age:{$gte:2}</td> <td>gte('age', 21)</td></tr> <tr><td>$lt</td> <td>小于</td> <td>Number</td> <td>$age:{$lt:100}</td> <td>lt('age',100)</td></tr> <tr><td>$lte</td> <td>小于等于</td> <td>Number</td> <td>$age:{$lte:10}</td> <td>lte('age',10)</td></tr> <tr><td>$ne</td> <td>不等于</td> <td>Number</td> <td>$age:{$ne:10}</td> <td>ne('age',10)</td></tr> <tr><td>$in</td> <td>在多个值范围内</td> <td>Number</td> <td>$age:{$in:100}</td> <td>in('age',100)</td></tr> <tr><td>$nin</td> <td>不在多个值范围内</td> <td>Number</td> <td>$age:{$nin:100}</td> <td>nin('age',100)</td></tr> <tr><td>$all</td> <td>匹配数组中多个值</td> <td>数组</td> <td>$pets:{$all:['dog', 'cat', 'ferret']}</td> <td>all('pets', ['dog', 'cat', 'ferret'])</td></tr> <tr><td>$regex</td> <td>正则，用于模糊查询</td> <td>String|RegExp</td> <td></td> <td></td></tr> <tr><td>$size</td> <td>匹配数组大小</td> <td>Number</td> <td></td> <td></td></tr> <tr><td>$maxDistance</td> <td>范围查询，距离（基于LBS）</td> <td></td> <td></td> <td></td></tr> <tr><td>$mod</td> <td>取模运算</td> <td></td> <td></td> <td>mod()</td></tr> <tr><td>$near</td> <td>邻域查询，查询附近的位置（基于LBS）</td> <td></td> <td></td> <td></td></tr> <tr><td>$exists</td> <td>字段是否存在</td> <td></td> <td></td> <td></td></tr> <tr><td>$elemMatch</td> <td>匹配内数组内的元素</td> <td></td> <td></td> <td></td></tr> <tr><td>$within</td> <td>范围查询（基于LBS）</td> <td></td> <td></td> <td></td></tr> <tr><td>$box</td> <td>范围查询，矩形范围（基于LBS）</td> <td></td> <td></td> <td></td></tr> <tr><td>$center</td> <td>范围醒询，圆形范围（基于LBS）</td> <td></td> <td></td> <td></td></tr> <tr><td>$centerSphere</td> <td>范围查询，球形范围（基于LBS）</td> <td></td> <td></td> <td></td></tr> <tr><td>$slice</td> <td>查询字段集合中的元素（比如从第几个之后，第N到第M个元素）</td> <td></td> <td></td> <td></td></tr></tbody></table> <h4 id="快捷函数"><a href="#快捷函数" class="header-anchor">#</a> 快捷函数</h4> <table><thead><tr><th><em><strong>name</strong></em></th> <th><em><strong>effect</strong></em></th></tr></thead> <tbody><tr><td>select</td> <td>添加需要显示的字段,需要的字段在字段后加上:1,不需要的加上0;<br>query.select({ a: 1, b: 0 }); //显示a字段, 隐藏b字段<br>不能和distinct方法一起使用</td></tr> <tr><td>distinct</td> <td>用来筛选不重复的值或者字段<br>distinct(field). //筛选指定不重复字段的数据</td></tr> <tr><td>$lt,$lte,$gt,$gte.</td> <td>分别对应: &lt;,&lt;=,&gt;,&gt;=. 该字段是用在condition中的.如果,你想要链式调用,则需要使用<br>lt,lte,ge,gte.<br>eg:<br> model.find({num:{$gt:12}},cb)<br>model.where(‘num’).gt(12).exec(cb)</td></tr> <tr><td>$in</td> <td>查询包含键值的文档,<br>model.find({name:{$in:[“jimmy”,“sam”]}}) //相当于匹配 jimmy或者sam</td></tr> <tr><td>$nin</td> <td>返回不匹配查询条件文档,都是指定数组类型<br>model.find({name:{$nin:[“jimmy”,“sam”]}})</td></tr> <tr><td>$ne</td> <td>表示不包含指定值<br>model.find({name:{$ne:“sam”}})</td></tr> <tr><td>$or</td> <td>表示或查询<br>model.find({$or:[{ color: ‘red’ }, { status: ‘emergency’ }]})</td></tr> <tr><td>$exits</td> <td>表示键值是否存在;<br>model.find({name:{$exits:true}})</td></tr> <tr><td>$all</td> <td>通常用来匹配数组里面的键值,匹配多个值(同时具有)<br>$all:[“apple”,“banana”,“peach”]}</td></tr> <tr><td>$size</td> <td>用来查询数组的长度值<br>model.find({name:{$size:3}}); 匹配name的数组长度为3</td></tr> <tr><td>$slice</td> <td>用来获取数组字段的内容:<br>query.slice(‘comments’, 5)</td></tr></tbody></table></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/cats1/vuepresshome/edit/main/docs/backend/mongodb/model.md" target="_blank" rel="noopener noreferrer">有问题需改善此页面!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/backend/mongodb/middleware.html" class="prev">
        中间件
      </a></span> <span class="next"><a href="/backend/mongodb/mongoose.html">
        mongoose
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a4743452.js" defer></script><script src="/assets/js/2.b72805e3.js" defer></script><script src="/assets/js/31.eac619f5.js" defer></script>
  </body>
</html>
